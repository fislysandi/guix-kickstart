<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--   Copyright (C) 2012-2022 Ludovic Courtès

Copyright (C) 2013, 2014, 2016 Andreas Enge

Copyright (C) 2013 Nikita Karetnikov

Copyright (C) 2014, 2015, 2016 Alex Kost

Copyright (C) 2015, 2016 Mathieu Lirzin

Copyright (C) 2014 Pierre-Antoine Rault

Copyright (C) 2015 Taylan Ulrich Bayırlı/Kammer

Copyright (C) 2015, 2016, 2017, 2019, 2020, 2021 Leo Famulari

Copyright (C) 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022 Ricardo Wurmus

Copyright (C) 2016 Ben Woodcroft

Copyright (C) 2016, 2017, 2018, 2021 Chris Marusich

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021, 2022 Efraim Flashner

Copyright (C) 2016 John Darrington

Copyright (C) 2016, 2017 Nikita Gillmann

Copyright (C) 2016, 2017, 2018, 2019, 2020 Jan Nieuwenhuizen

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021 Julien Lepiller

Copyright (C) 2016 Alex ter Weele

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021 Christopher Baines

Copyright (C) 2017, 2018, 2019 Clément Lassieur

Copyright (C) 2017, 2018, 2020, 2021, 2022 Mathieu Othacehe

Copyright (C) 2017 Federico Beffa

Copyright (C) 2017, 2018 Carlo Zancanaro

Copyright (C) 2017 Thomas Danckaert

Copyright (C) 2017 humanitiesNerd

Copyright (C) 2017, 2021 Christine Lemmer-Webber

Copyright (C) 2017, 2018, 2019, 2020, 2021, 2022 Marius Bakke

Copyright (C) 2017, 2019, 2020, 2022 Hartmut Goebel

Copyright (C) 2017, 2019, 2020, 2021, 2022 Maxim Cournoyer

Copyright (C) 2017–2022 Tobias Geerinckx-Rice

Copyright (C) 2017 George Clemmer

Copyright (C) 2017 Andy Wingo

Copyright (C) 2017, 2018, 2019, 2020 Arun Isaac

Copyright (C) 2017 nee

Copyright (C) 2018 Rutger Helling

Copyright (C) 2018, 2021 Oleg Pykhalov

Copyright (C) 2018 Mike Gerwitz

Copyright (C) 2018 Pierre-Antoine Rouby

Copyright (C) 2018, 2019 Gábor Boskovits

Copyright (C) 2018, 2019, 2020, 2022 Florian Pelz

Copyright (C) 2018 Laura Lazzati

Copyright (C) 2018 Alex Vong

Copyright (C) 2019 Josh Holland

Copyright (C) 2019, 2020 Diego Nicola Barbato

Copyright (C) 2019 Ivan Petkov

Copyright (C) 2019 Jakob L. Kreuze

Copyright (C) 2019 Kyle Andrews

Copyright (C) 2019 Alex Griffin

Copyright (C) 2019, 2020, 2021, 2022 Guillaume Le Vaillant

Copyright (C) 2020 Liliana Marie Prikler

Copyright (C) 2019, 2020, 2021, 2022 Simon Tournier

Copyright (C) 2020 Wiktor Żelazny

Copyright (C) 2020 Damien Cassou

Copyright (C) 2020 Jakub Kądziołka

Copyright (C) 2020 Jack Hill

Copyright (C) 2020 Naga Malleswari

Copyright (C) 2020, 2021 Brice Waegeneire

Copyright (C) 2020 R Veera Kumar

Copyright (C) 2020, 2021 Pierre Langlois

Copyright (C) 2020 pinoaffe

Copyright (C) 2020 André Batista

Copyright (C) 2020, 2021 Alexandru-Sergiu Marton

Copyright (C) 2020 raingloom

Copyright (C) 2020 Daniel Brooks

Copyright (C) 2020 John Soo

Copyright (C) 2020 Jonathan Brielmaier

Copyright (C) 2020 Edgar Vincent

Copyright (C) 2021, 2022 Maxime Devos

Copyright (C) 2021 B. Wilson

Copyright (C) 2021 Xinglu Chen

Copyright (C) 2021 Raghav Gururajan

Copyright (C) 2021 Domagoj Stolfa

Copyright (C) 2021 Hui Lu

Copyright (C) 2021 pukkamustard

Copyright (C) 2021 Alice Brenon

Copyright (C) 2021, 2022 Josselin Poiret

Copyright (C) 2021 muradm

Copyright (C) 2021, 2022 Andrew Tropin

Copyright (C) 2021 Sarah Morgensen

Copyright (C) 2022 Remco van 't Veer

Copyright (C) 2022 Aleksandr Vityazev

Copyright (C) 2022 Philip McGrath

Copyright (C) 2022 Karl Hallsby

Copyright (C) 2022 Justin Veilleux

Copyright (C) 2022 Reily Siegel

Copyright (C) 2022 Simon Streit

Copyright (C) 2022 (

Copyright (C) 2022 John Kehayias


Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.  A
copy of the license is included in the section entitled "GNU Free
Documentation License".   -->
<!--   Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/   -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Web Services (GNU Guix Reference Manual)</title>

<meta name="description" content="Web Services (GNU Guix Reference Manual)" />
<meta name="keywords" content="Web Services (GNU Guix Reference Manual)" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="Generator" content="makeinfo" />
<link href="index.html" rel="start" title="Top" />
<link href="Concept-Index.html" rel="index" title="Concept Index" />
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents" />
<link href="Services.html" rel="up" title="Services" />
<link href="Certificate-Services.html" rel="next" title="Certificate Services" />
<link href="LDAP-Services.html" rel="prev" title="LDAP Services" />
<style type="text/css">
&amp;lt;!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
--&amp;gt;
</style>
<link rel="stylesheet" type="text/css" href="https://www.gnu.org/software/gnulib/manual.css" />

<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" type="text/css" href="../../../static/base/css/manual.css" /><link rel="stylesheet" type="text/css" href="../../../static/base/css/code.css" /></head>

<body lang="en"><header class="navbar"><h1><a class="branding" href="https://guix.gnu.org/manual/en/"></a></h1><nav class="navbar-menu"><input class="navbar-menu-hidden-input" type="radio" name="dropdown" id="all-dropdowns-hidden" /><ul><li class="navbar-menu-item dropdown dropdown-btn"><input class="navbar-menu-hidden-input" type="radio" name="dropdown" id="visible-dropdown" /><label for="visible-dropdown"><img alt="Language" src="../../../static/base/img/language-picker.svg" /></label><label for="all-dropdowns-hidden"><img alt="Language" src="../../../static/base/img/language-picker.svg" /></label><div class="navbar-submenu" id="navbar-submenu"><div class="navbar-submenu-triangle"> </div><ul><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/de/html_node">Deutsch</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/en/html_node">English</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/es/html_node">Español</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/fr/html_node">français</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/pt-br/html_node">Português</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/ru/html_node">русский</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/zh-cn/html_node">中文</a></li><li><a class="navbar-menu-item" href="https://translate.fedoraproject.org/projects/guix/documentation-manual/">⊕</a></li></ul></div></li></ul></nav><a class="navbar-menu-btn" href="https://guix.gnu.org/manual/"></a></header>
<span id="Web-Services"></span><div class="header">
<p>
Next: <a href="Certificate-Services.html" accesskey="n" rel="next">Certificate Services</a>, Previous: <a href="LDAP-Services.html" accesskey="p" rel="prev">LDAP Services</a>, Up: <a href="Services.html" accesskey="u" rel="up">Services</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr />
<span id="Web-Services-1"></span><h4 class="subsection">12.9.19 Web Services</h4>

<span id="index-web"></span>
<span id="index-www"></span>
<span id="index-HTTP"></span>
<p>The <code>(gnu services web)</code> module provides the Apache HTTP Server,
the nginx web server, and also a fastcgi wrapper daemon.
</p>
<span id="Apache-HTTP-Server"></span><h4 class="subsubheading">Apache HTTP Server</h4>

<dl>
<dt id="index-httpd_002dservice_002dtype" class="symbol-definition"><span class="symbol-definition-category">Scheme Variable: </span><span class="symbol-definition-prototype">httpd-service-type </span></dt>
<dd><p>Service type for the <a href="https://httpd.apache.org/">Apache HTTP</a> server
(<em>httpd</em>).  The value for this service type is a
<code>httpd-configuration</code> record.
</p>
<p>A simple example configuration is given below.
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Web-Services.html#index-httpd_002dservice_002dtype">httpd-service-type</a>
         <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-httpd_002dconfiguration">httpd-configuration</a>
           <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">config</span>
             <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-httpd_002dconfig_002dfile">httpd-config-file</a>
               <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">server-name</span> <span class="syntax-string">"www.example.com"</span></span>)</span>
               <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">document-root</span> <span class="syntax-string">"/srv/http/www.example.com"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
</pre></div>

<p>Other services can also extend the <code>httpd-service-type</code> to add to
the configuration.
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-simple_002dservice">simple-service</a> <span class="syntax-symbol">'www.example.com-server</span> <a class="syntax-symbol" href="Web-Services.html#index-httpd_002dservice_002dtype">httpd-service-type</a>
                <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a>
                  <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-httpd_002dvirtualhost">httpd-virtualhost</a>
                    <span class="syntax-string">"*:80"</span>
                    <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/String-Constructors.html#index-string_002djoin">string-join</a> <span class="syntax-symbol">'</span><span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-string">"ServerName www.example.com"</span>
                                          <span class="syntax-string">"DocumentRoot /srv/http/www.example.com"</span></span>)</span>
                                       <span class="syntax-string">"\n"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
</pre></div>
</dd></dl>

<p>The details for the <code>httpd-configuration</code>, <code>httpd-module</code>,
<code>httpd-config-file</code> and <code>httpd-virtualhost</code> record types are
given below.
</p>
<dl>
<dt id="index-httpd_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">httpd-configuration </span></dt>
<dd><p>This data type represents the configuration for the httpd service.
</p>
<dl compact="compact">
<dt><code>package</code> (default: <code>httpd</code>)</dt>
<dd><p>The httpd package to use.
</p>
</dd>
<dt><code>pid-file</code> (default: <code>"/var/run/httpd"</code>)</dt>
<dd><p>The pid file used by the shepherd-service.
</p>
</dd>
<dt><code>config</code> (default: <code>(httpd-config-file)</code>)</dt>
<dd><p>The configuration file to use with the httpd service.  The default value
is a <code>httpd-config-file</code> record, but this can also be a different
G-expression that generates a file, for example a <code>plain-file</code>.  A
file outside of the store can also be specified through a string.
</p>
</dd>
</dl>
</dd></dl>

<dl>
<dt id="index-httpd_002dmodule" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">httpd-module </span></dt>
<dd><p>This data type represents a module for the httpd service.
</p>
<dl compact="compact">
<dt><code>name</code></dt>
<dd><p>The name of the module.
</p>
</dd>
<dt><code>file</code></dt>
<dd><p>The file for the module.  This can be relative to the httpd package being
used, the absolute location of a file, or a G-expression for a file
within the store, for example <code>(file-append mod-wsgi
"/modules/mod_wsgi.so")</code>.
</p>
</dd>
</dl>
</dd></dl>

<dl>
<dt id="index-_0025default_002dhttpd_002dmodules" class="symbol-definition"><span class="symbol-definition-category">Scheme Variable: </span><span class="symbol-definition-prototype">%default-httpd-modules </span></dt>
<dd><p>A default list of <code>httpd-module</code> objects.
</p></dd></dl>

<dl>
<dt id="index-httpd_002dconfig_002dfile" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">httpd-config-file </span></dt>
<dd><p>This data type represents a configuration file for the httpd service.
</p>
<dl compact="compact">
<dt><code>modules</code> (default: <code>%default-httpd-modules</code>)</dt>
<dd><p>The modules to load.  Additional modules can be added here, or loaded by
additional configuration.
</p>
<p>For example, in order to handle requests for PHP files, you can use Apache’s
<code>mod_proxy_fcgi</code> module along with <code>php-fpm-service-type</code>:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Web-Services.html#index-httpd_002dservice_002dtype">httpd-service-type</a>
         <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-httpd_002dconfiguration">httpd-configuration</a>
          <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">config</span>
           <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-httpd_002dconfig_002dfile">httpd-config-file</a>
            <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">modules</span> <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-cons_002a">cons*</a>
                      <span class="syntax-paren6">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-httpd_002dmodule">httpd-module</a>
                       <span class="syntax-paren7">(<span class="syntax-symbol"><span class="syntax-symbol">name</span> <span class="syntax-string">"proxy_module"</span></span>)</span>
                       <span class="syntax-paren7">(<span class="syntax-symbol"><span class="syntax-symbol">file</span> <span class="syntax-string">"modules/mod_proxy.so"</span></span>)</span></span>)</span>
                      <span class="syntax-paren6">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-httpd_002dmodule">httpd-module</a>
                       <span class="syntax-paren7">(<span class="syntax-symbol"><span class="syntax-symbol">name</span> <span class="syntax-string">"proxy_fcgi_module"</span></span>)</span>
                       <span class="syntax-paren7">(<span class="syntax-symbol"><span class="syntax-symbol">file</span> <span class="syntax-string">"modules/mod_proxy_fcgi.so"</span></span>)</span></span>)</span>
                      <a class="syntax-symbol" href="Web-Services.html#index-_0025default_002dhttpd_002dmodules">%default-httpd-modules</a></span>)</span></span>)</span>
            <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">extra-config</span> <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-string">"\
&lt;FilesMatch \\.php$&gt;
    SetHandler \"proxy:unix:/var/run/php-fpm.sock|fcgi://localhost/\"
&lt;/FilesMatch&gt;"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
<span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Web-Services.html#index-php_002dfpm_002dservice_002dtype">php-fpm-service-type</a>
         <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-php_002dfpm_002dconfiguration">php-fpm-configuration</a>
          <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Network-Sockets-and-Communication.html#index-socket-1">socket</a> <span class="syntax-string">"/var/run/php-fpm.sock"</span></span>)</span>
          <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">socket-group</span> <span class="syntax-string">"httpd"</span></span>)</span></span>)</span></span>)</span>
</pre></div>

</dd>
<dt><code>server-root</code> (default: <code>httpd</code>)</dt>
<dd><p>The <code>ServerRoot</code> in the configuration file, defaults to the httpd
package.  Directives including <code>Include</code> and <code>LoadModule</code> are
taken as relative to the server root.
</p>
</dd>
<dt><code>server-name</code> (default: <code>#f</code>)</dt>
<dd><p>The <code>ServerName</code> in the configuration file, used to specify the
request scheme, hostname and port that the server uses to identify
itself.
</p>
<p>This doesn&rsquo;t need to be set in the server config, and can be specified
in virtual hosts.  The default is <code>#f</code> to not specify a
<code>ServerName</code>.
</p>
</dd>
<dt><code>document-root</code> (default: <code>"/srv/http"</code>)</dt>
<dd><p>The <code>DocumentRoot</code> from which files will be served.
</p>
</dd>
<dt><code>listen</code> (default: <code>'("80")</code>)</dt>
<dd><p>The list of values for the <code>Listen</code> directives in the config
file.  The value should be a list of strings, when each string can
specify the port number to listen on, and optionally the IP address and
protocol to use.
</p>
</dd>
<dt><code>pid-file</code> (default: <code>"/var/run/httpd"</code>)</dt>
<dd><p>The <code>PidFile</code> to use.  This should match the <code>pid-file</code> set in
the <code>httpd-configuration</code> so that the Shepherd service is
configured correctly.
</p>
</dd>
<dt><code>error-log</code> (default: <code>"/var/log/httpd/error_log"</code>)</dt>
<dd><p>The <code>ErrorLog</code> to which the server will log errors.
</p>
</dd>
<dt><code>user</code> (default: <code>"httpd"</code>)</dt>
<dd><p>The <code>User</code> which the server will answer requests as.
</p>
</dd>
<dt><code>group</code> (default: <code>"httpd"</code>)</dt>
<dd><p>The <code>Group</code> which the server will answer requests as.
</p>
</dd>
<dt><code>extra-config</code> (default: <code>(list "TypesConfig etc/httpd/mime.types")</code>)</dt>
<dd><p>A flat list of strings and G-expressions which will be added to the end
of the configuration file.
</p>
<p>Any values which the service is extended with will be appended to this
list.
</p>
</dd>
</dl>
</dd></dl>

<dl>
<dt id="index-httpd_002dvirtualhost" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">httpd-virtualhost </span></dt>
<dd><p>This data type represents a virtualhost configuration block for the httpd service.
</p>
<p>These should be added to the extra-config for the httpd-service.
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-simple_002dservice">simple-service</a> <span class="syntax-symbol">'www.example.com-server</span> <a class="syntax-symbol" href="Web-Services.html#index-httpd_002dservice_002dtype">httpd-service-type</a>
                <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a>
                  <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-httpd_002dvirtualhost">httpd-virtualhost</a>
                    <span class="syntax-string">"*:80"</span>
                    <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/String-Constructors.html#index-string_002djoin">string-join</a> <span class="syntax-symbol">'</span><span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-string">"ServerName www.example.com"</span>
                                          <span class="syntax-string">"DocumentRoot /srv/http/www.example.com"</span></span>)</span>
                                       <span class="syntax-string">"\n"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
</pre></div>

<dl compact="compact">
<dt><code>addresses-and-ports</code></dt>
<dd><p>The addresses and ports for the <code>VirtualHost</code> directive.
</p>
</dd>
<dt><code>contents</code></dt>
<dd><p>The contents of the <code>VirtualHost</code> directive, this should be a list
of strings and G-expressions.
</p>
</dd>
</dl>
</dd></dl>

<span id="NGINX"></span><span id="NGINX-1"></span><h4 class="subsubheading">NGINX</h4>

<dl>
<dt id="index-nginx_002dservice_002dtype" class="symbol-definition"><span class="symbol-definition-category">Scheme Variable: </span><span class="symbol-definition-prototype">nginx-service-type </span></dt>
<dd><p>Service type for the <a href="https://nginx.org/">NGinx</a> web server.  The
value for this service type is a <code>&lt;nginx-configuration&gt;</code> record.
</p>
<p>A simple example configuration is given below.
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Web-Services.html#index-nginx_002dservice_002dtype">nginx-service-type</a>
         <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-nginx_002dconfiguration">nginx-configuration</a>
           <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">server-blocks</span>
             <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-nginx_002dserver_002dconfiguration">nginx-server-configuration</a>
                     <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">server-name</span> <span class="syntax-symbol">'</span><span class="syntax-paren6">(<span class="syntax-symbol"><span class="syntax-string">"www.example.com"</span></span>)</span></span>)</span>
                     <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">root</span> <span class="syntax-string">"/srv/http/www.example.com"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
</pre></div>

<p>In addition to adding server blocks to the service configuration
directly, this service can be extended by other services to add server
blocks, as in this example:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-simple_002dservice">simple-service</a> <span class="syntax-symbol">'my-extra-server</span> <a class="syntax-symbol" href="Web-Services.html#index-nginx_002dservice_002dtype">nginx-service-type</a>
                <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-nginx_002dserver_002dconfiguration">nginx-server-configuration</a>
                        <span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-symbol">root</span> <span class="syntax-string">"/srv/http/extra-website"</span></span>)</span>
                        <span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-symbol">try-files</span> <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-string">"$uri"</span> <span class="syntax-string">"$uri/index.html"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
</pre></div>
</dd></dl>

<p>At startup, <code>nginx</code> has not yet read its configuration file, so
it uses a default file to log error messages.  If it fails to load its
configuration file, that is where error messages are logged.  After the
configuration file is loaded, the default error log file changes as per
configuration.  In our case, startup error messages can be found in
<samp>/var/run/nginx/logs/error.log</samp>, and after configuration in
<samp>/var/log/nginx/error.log</samp>.  The second location can be changed
with the <var>log-directory</var> configuration option.
</p>
<dl>
<dt id="index-nginx_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">nginx-configuration </span></dt>
<dd><p>This data type represents the configuration for NGinx.  Some
configuration can be done through this and the other provided record
types, or alternatively, a config file can be provided.
</p>
<dl compact="compact">
<dt><code>nginx</code> (default: <code>nginx</code>)</dt>
<dd><p>The nginx package to use.
</p>
</dd>
<dt><code>shepherd-requirement</code> (default: <code>'()</code>)</dt>
<dd><p>This is a list of symbols naming Shepherd services the nginx service
will depend on.
</p>
<p>This is useful if you would like <code>nginx</code> to be started after a
back-end web server or a logging service such as Anonip has been
started.
</p>
</dd>
<dt><code>log-directory</code> (default: <code>"/var/log/nginx"</code>)</dt>
<dd><p>The directory to which NGinx will write log files.
</p>
</dd>
<dt><code>run-directory</code> (default: <code>"/var/run/nginx"</code>)</dt>
<dd><p>The directory in which NGinx will create a pid file, and write temporary
files.
</p>
</dd>
<dt><code>server-blocks</code> (default: <code>'()</code>)</dt>
<dd><p>A list of <em>server blocks</em> to create in the generated configuration
file, the elements should be of type
<code>&lt;nginx-server-configuration&gt;</code>.
</p>
<p>The following example would setup NGinx to serve <code>www.example.com</code>
from the <code>/srv/http/www.example.com</code> directory, without using
HTTPS.
</p><div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Web-Services.html#index-nginx_002dservice_002dtype">nginx-service-type</a>
         <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-nginx_002dconfiguration">nginx-configuration</a>
           <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">server-blocks</span>
             <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-nginx_002dserver_002dconfiguration">nginx-server-configuration</a>
                     <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">server-name</span> <span class="syntax-symbol">'</span><span class="syntax-paren6">(<span class="syntax-symbol"><span class="syntax-string">"www.example.com"</span></span>)</span></span>)</span>
                     <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">root</span> <span class="syntax-string">"/srv/http/www.example.com"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
</pre></div>

</dd>
<dt><code>upstream-blocks</code> (default: <code>'()</code>)</dt>
<dd><p>A list of <em>upstream blocks</em> to create in the generated configuration
file, the elements should be of type
<code>&lt;nginx-upstream-configuration&gt;</code>.
</p>
<p>Configuring upstreams through the <code>upstream-blocks</code> can be useful
when combined with <code>locations</code> in the
<code>&lt;nginx-server-configuration&gt;</code> records.  The following example
creates a server configuration with one location configuration, that
will proxy requests to a upstream configuration, which will handle
requests with two servers.
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a>
  <a class="syntax-symbol" href="Web-Services.html#index-nginx_002dservice_002dtype">nginx-service-type</a>
  <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-nginx_002dconfiguration">nginx-configuration</a>
    <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">server-blocks</span>
      <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-nginx_002dserver_002dconfiguration">nginx-server-configuration</a>
              <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">server-name</span> <span class="syntax-symbol">'</span><span class="syntax-paren6">(<span class="syntax-symbol"><span class="syntax-string">"www.example.com"</span></span>)</span></span>)</span>
              <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">root</span> <span class="syntax-string">"/srv/http/www.example.com"</span></span>)</span>
              <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">locations</span>
                <span class="syntax-paren6">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a>
                  <span class="syntax-paren7">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-nginx_002dlocation_002dconfiguration">nginx-location-configuration</a>
                  <span class="syntax-paren8">(<span class="syntax-symbol"><span class="syntax-symbol">uri</span> <span class="syntax-string">"/path1"</span></span>)</span>
                  <span class="syntax-paren8">(<span class="syntax-symbol"><span class="syntax-symbol">body</span> <span class="syntax-symbol">'</span><span class="syntax-paren9">(<span class="syntax-symbol"><span class="syntax-string">"proxy_pass http://server-proxy;"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
    <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">upstream-blocks</span>
      <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-nginx_002dupstream_002dconfiguration">nginx-upstream-configuration</a>
              <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">name</span> <span class="syntax-string">"server-proxy"</span></span>)</span>
              <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">servers</span> <span class="syntax-paren6">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-string">"server1.example.com"</span>
                             <span class="syntax-string">"server2.example.com"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
</pre></div>

</dd>
<dt><code>file</code> (default: <code>#f</code>)</dt>
<dd><p>If a configuration <var>file</var> is provided, this will be used, rather than
generating a configuration file from the provided <code>log-directory</code>,
<code>run-directory</code>, <code>server-blocks</code> and <code>upstream-blocks</code>.  For
proper operation, these arguments should match what is in <var>file</var> to ensure
that the directories are created when the service is activated.
</p>
<p>This can be useful if you have an existing configuration file, or it&rsquo;s
not possible to do what is required through the other parts of the
nginx-configuration record.
</p>
</dd>
<dt><code>server-names-hash-bucket-size</code> (default: <code>#f</code>)</dt>
<dd><p>Bucket size for the server names hash tables, defaults to <code>#f</code> to
use the size of the processors cache line.
</p>
</dd>
<dt><code>server-names-hash-bucket-max-size</code> (default: <code>#f</code>)</dt>
<dd><p>Maximum bucket size for the server names hash tables.
</p>
</dd>
<dt><code>modules</code> (default: <code>'()</code>)</dt>
<dd><p>List of nginx dynamic modules to load.  This should be a list of file
names of loadable modules, as in this example:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-symbol">modules</span>
 <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a>
  <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="G_002dExpressions.html#index-file_002dappend">file-append</a> <span class="syntax-symbol">nginx-accept-language-module</span> <span class="syntax-string">"\
/etc/nginx/modules/ngx_http_accept_language_module.so"</span></span>)</span>
  <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="G_002dExpressions.html#index-file_002dappend">file-append</a> <span class="syntax-symbol">nginx-lua-module</span> <span class="syntax-string">"\
/etc/nginx/modules/ngx_http_lua_module.so"</span></span>)</span></span>)</span></span>)</span>
</pre></div>

</dd>
<dt><code>lua-package-path</code> (default: <code>'()</code>)</dt>
<dd><p>List of nginx lua packages to load.  This should be a list of package
names of loadable lua modules, as in this example:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-symbol">lua-package-path</span> <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-symbol">lua-resty-core</span>
                        <span class="syntax-symbol">lua-resty-lrucache</span>
                        <span class="syntax-symbol">lua-resty-signal</span>
                        <span class="syntax-symbol">lua-tablepool</span>
                        <span class="syntax-symbol">lua-resty-shell</span></span>)</span></span>)</span>
</pre></div>

</dd>
<dt><code>lua-package-cpath</code> (default: <code>'()</code>)</dt>
<dd><p>List of nginx lua C packages to load.  This should be a list of package
names of loadable lua C modules, as in this example:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-symbol">lua-package-cpath</span> <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-symbol">lua-resty-signal</span></span>)</span></span>)</span>
</pre></div>

</dd>
<dt><code>global-directives</code> (default: <code>'((events . ()))</code>)</dt>
<dd><p>Association list of global directives for the top level of the nginx
configuration.  Values may themselves be association lists.
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-symbol">global-directives</span>
 <span class="syntax-symbol">`</span><span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">worker_processes</span> <span class="syntax-symbol">.</span> <span class="syntax-symbol">16</span></span>)</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">pcre_jit</span> <span class="syntax-symbol">.</span> <span class="syntax-symbol">on</span></span>)</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">events</span> <span class="syntax-symbol">.</span> <span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">worker_connections</span> <span class="syntax-symbol">.</span> <span class="syntax-symbol">1024</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
</pre></div>

</dd>
<dt><code>extra-content</code> (default: <code>""</code>)</dt>
<dd><p>Extra content for the <code>http</code> block.  Should be string or a string
valued G-expression.
</p>
</dd>
</dl>
</dd></dl>

<span id="nginx_002dserver_002dconfiguration"></span><dl>
<dt id="index-nginx_002dserver_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">nginx-server-configuration </span></dt>
<dd><p>Data type representing the configuration of an nginx server block.
This type has the following parameters:
</p>
<dl compact="compact">
<dt><code>listen</code> (default: <code>'("80" "443 ssl")</code>)</dt>
<dd><p>Each <code>listen</code> directive sets the address and port for IP, or the
path for a UNIX-domain socket on which the server will accept requests.
Both address and port, or only address or only port can be specified.
An address may also be a hostname, for example:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-symbol">'</span><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-string">"127.0.0.1:8000"</span> <span class="syntax-string">"127.0.0.1"</span> <span class="syntax-string">"8000"</span> <span class="syntax-string">"*:8000"</span> <span class="syntax-string">"localhost:8000"</span></span>)</span>
</pre></div>

</dd>
<dt><code>server-name</code> (default: <code>(list 'default)</code>)</dt>
<dd><p>A list of server names this server represents. <code>'default</code> represents the
default server for connections matching no other server.
</p>
</dd>
<dt><code>root</code> (default: <code>"/srv/http"</code>)</dt>
<dd><p>Root of the website nginx will serve.
</p>
</dd>
<dt><code>locations</code> (default: <code>'()</code>)</dt>
<dd><p>A list of <em>nginx-location-configuration</em> or
<em>nginx-named-location-configuration</em> records to use within this
server block.
</p>
</dd>
<dt><code>index</code> (default: <code>(list "index.html")</code>)</dt>
<dd><p>Index files to look for when clients ask for a directory.  If it cannot be found,
Nginx will send the list of files in the directory.
</p>
</dd>
<dt><code>try-files</code> (default: <code>'()</code>)</dt>
<dd><p>A list of files whose existence is checked in the specified order.
<code>nginx</code> will use the first file it finds to process the request.
</p>
</dd>
<dt><code>ssl-certificate</code> (default: <code>#f</code>)</dt>
<dd><p>Where to find the certificate for secure connections.  Set it to <code>#f</code> if
you don&rsquo;t have a certificate or you don&rsquo;t want to use HTTPS.
</p>
</dd>
<dt><code>ssl-certificate-key</code> (default: <code>#f</code>)</dt>
<dd><p>Where to find the private key for secure connections.  Set it to <code>#f</code> if
you don&rsquo;t have a key or you don&rsquo;t want to use HTTPS.
</p>
</dd>
<dt><code>server-tokens?</code> (default: <code>#f</code>)</dt>
<dd><p>Whether the server should add its configuration to response.
</p>
</dd>
<dt><code>raw-content</code> (default: <code>'()</code>)</dt>
<dd><p>A list of raw lines added to the server block.
</p>
</dd>
</dl>
</dd></dl>

<dl>
<dt id="index-nginx_002dupstream_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">nginx-upstream-configuration </span></dt>
<dd><p>Data type representing the configuration of an nginx <code>upstream</code>
block.  This type has the following parameters:
</p>
<dl compact="compact">
<dt><code>name</code></dt>
<dd><p>Name for this group of servers.
</p>
</dd>
<dt><code>servers</code></dt>
<dd><p>Specify the addresses of the servers in the group.  The address can be
specified as a IP address (e.g. &lsquo;<samp>127.0.0.1</samp>&rsquo;), domain name
(e.g. &lsquo;<samp>backend1.example.com</samp>&rsquo;) or a path to a UNIX socket using the
prefix &lsquo;<samp>unix:</samp>&rsquo;.  For addresses using an IP address or domain name,
the default port is 80, and a different port can be specified
explicitly.
</p>
</dd>
<dt><code>extra-content</code></dt>
<dd><p>A string or list of strings to add to the upstream block.
</p>
</dd>
</dl>
</dd></dl>

<dl>
<dt id="index-nginx_002dlocation_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">nginx-location-configuration </span></dt>
<dd><p>Data type representing the configuration of an nginx <code>location</code>
block.  This type has the following parameters:
</p>
<dl compact="compact">
<dt><code>uri</code></dt>
<dd><p>URI which this location block matches.
</p>
<span id="nginx_002dlocation_002dconfiguration-body"></span></dd>
<dt><code>body</code></dt>
<dd><p>Body of the location block, specified as a list of strings.  This can contain
many
configuration directives.  For example, to pass requests to a upstream
server group defined using an <code>nginx-upstream-configuration</code> block,
the following directive would be specified in the body &lsquo;<samp>(list "proxy_pass
http://upstream-name;")</samp>&rsquo;.
</p>
</dd>
</dl>
</dd></dl>

<dl>
<dt id="index-nginx_002dnamed_002dlocation_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">nginx-named-location-configuration </span></dt>
<dd><p>Data type representing the configuration of an nginx named location
block.  Named location blocks are used for request redirection, and not
used for regular request processing.  This type has the following
parameters:
</p>
<dl compact="compact">
<dt><code>name</code></dt>
<dd><p>Name to identify this location block.
</p>
</dd>
<dt><code>body</code></dt>
<dd><p>See <a href="Web-Services.html#nginx_002dlocation_002dconfiguration-body">nginx-location-configuration body</a>, as the body for named location
blocks can be used in a similar way to the
<code>nginx-location-configuration body</code>.  One restriction is that the
body of a named location block cannot contain location blocks.
</p>
</dd>
</dl>
</dd></dl>

<span id="Varnish-Cache"></span><h4 class="subsubheading">Varnish Cache</h4>
<span id="index-Varnish"></span>
<p>Varnish is a fast cache server that sits in between web applications
and end users.  It proxies requests from clients and caches the
accessed URLs such that multiple requests for the same resource only
creates one request to the back-end.
</p>
<dl>
<dt id="index-varnish_002dservice_002dtype" class="symbol-definition"><span class="symbol-definition-category">Scheme Variable: </span><span class="symbol-definition-prototype">varnish-service-type </span></dt>
<dd><p>Service type for the Varnish daemon.
</p></dd></dl>

<dl>
<dt id="index-varnish_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">varnish-configuration </span></dt>
<dd><p>Data type representing the <code>varnish</code> service configuration.
This type has the following parameters:
</p>
<dl compact="compact">
<dt><code>package</code> (default: <code>varnish</code>)</dt>
<dd><p>The Varnish package to use.
</p>
</dd>
<dt><code>name</code> (default: <code>"default"</code>)</dt>
<dd><p>A name for this Varnish instance.  Varnish will create a directory in
<samp>/var/varnish/</samp> with this name and keep temporary files there.  If
the name starts with a forward slash, it is interpreted as an absolute
directory name.
</p>
<p>Pass the <code>-n</code> argument to other Varnish programs to connect to the
named instance, e.g. <code>varnishncsa -n default</code>.
</p>
</dd>
<dt><code>backend</code> (default: <code>"localhost:8080"</code>)</dt>
<dd><p>The backend to use.  This option has no effect if <code>vcl</code> is set.
</p>
</dd>
<dt><code>vcl</code> (default: #f)</dt>
<dd><p>The <em>VCL</em> (Varnish Configuration Language) program to run.  If this
is <code>#f</code>, Varnish will proxy <code>backend</code> using the default
configuration.  Otherwise this must be a file-like object with valid
VCL syntax.
</p>
<p>For example, to mirror <a href="https://www.gnu.org">www.gnu.org</a> with VCL you
can do something along these lines:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-symbol">%gnu-mirror</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="G_002dExpressions.html#index-plain_002dfile">plain-file</a> <span class="syntax-string">"gnu.vcl"</span>
              <span class="syntax-string">"vcl 4.1;
backend gnu { .host = \"www.gnu.org\"; }"</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="operating_002dsystem-Reference.html#index-operating_002dsystem-1">operating-system</a>
  <span class="syntax-comment">;; …
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">services</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Pairs.html#index-cons">cons</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Web-Services.html#index-varnish_002dservice_002dtype">varnish-service-type</a>
                           <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-varnish_002dconfiguration">varnish-configuration</a>
                            <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Network-Sockets-and-Communication.html#index-listen">listen</a> <span class="syntax-symbol">'</span><span class="syntax-paren6">(<span class="syntax-symbol"><span class="syntax-string">":80"</span></span>)</span></span>)</span>
                            <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">vcl</span> <span class="syntax-symbol">%gnu-mirror</span></span>)</span></span>)</span></span>)</span>
                  <a class="syntax-symbol" href="Base-Services.html#index-_0025base_002dservices-1">%base-services</a></span>)</span></span>)</span></span>)</span>
</pre></div>

<p>The configuration of an already running Varnish instance can be inspected
and changed using the <code>varnishadm</code> program.
</p>
<p>Consult the <a href="https://varnish-cache.org/docs/">Varnish User Guide</a> and
<a href="https://book.varnish-software.com/4.0/">Varnish Book</a> for
comprehensive documentation on Varnish and its configuration language.
</p>
</dd>
<dt><code>listen</code> (default: <code>'("localhost:80")</code>)</dt>
<dd><p>List of addresses Varnish will listen on.
</p>
</dd>
<dt><code>storage</code> (default: <code>'("malloc,128m")</code>)</dt>
<dd><p>List of storage backends that will be available in VCL.
</p>
</dd>
<dt><code>parameters</code> (default: <code>'()</code>)</dt>
<dd><p>List of run-time parameters in the form <code>'(("parameter" . "value"))</code>.
</p>
</dd>
<dt><code>extra-options</code> (default: <code>'()</code>)</dt>
<dd><p>Additional arguments to pass to the <code>varnishd</code> process.
</p>
</dd>
</dl>
</dd></dl>

<span id="Patchwork"></span><h4 class="subsubheading">Patchwork</h4>
<span id="index-Patchwork"></span>
<p>Patchwork is a patch tracking system.  It can collect patches sent to a
mailing list, and display them in a web interface.
</p>
<dl>
<dt id="index-patchwork_002dservice_002dtype" class="symbol-definition"><span class="symbol-definition-category">Scheme Variable: </span><span class="symbol-definition-prototype">patchwork-service-type </span></dt>
<dd><p>Service type for Patchwork.
</p></dd></dl>

<p>The following example is an example of a minimal service for Patchwork, for
the <code>patchwork.example.com</code> domain.
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Web-Services.html#index-patchwork_002dservice_002dtype">patchwork-service-type</a>
         <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-patchwork_002dconfiguration">patchwork-configuration</a>
          <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">domain</span> <span class="syntax-string">"patchwork.example.com"</span></span>)</span>
          <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">settings-module</span>
           <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-patchwork_002dsettings_002dmodule">patchwork-settings-module</a>
            <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">allowed-hosts</span> <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-symbol">domain</span></span>)</span></span>)</span>
            <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">default-from-email</span> <span class="syntax-string">"patchwork@patchwork.example.com"</span></span>)</span></span>)</span></span>)</span>
          <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">getmail-retriever-config</span>
           <span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-symbol">getmail-retriever-configuration</span>
            <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">type</span> <span class="syntax-string">"SimpleIMAPSSLRetriever"</span></span>)</span>
            <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">server</span> <span class="syntax-string">"imap.example.com"</span></span>)</span>
            <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">port</span> <span class="syntax-symbol">993</span></span>)</span>
            <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">username</span> <span class="syntax-string">"patchwork"</span></span>)</span>
            <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">password-command</span>
             <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren6">(<span class="syntax-symbol"><a class="syntax-symbol" href="G_002dExpressions.html#index-file_002dappend">file-append</a> <span class="syntax-symbol">coreutils</span> <span class="syntax-string">"/bin/cat"</span></span>)</span>
                   <span class="syntax-string">"/etc/getmail-patchwork-imap-password"</span></span>)</span></span>)</span>
            <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">extra-parameters</span>
            <span class="syntax-symbol">'</span><span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-paren6">(<span class="syntax-symbol"><span class="syntax-symbol">mailboxes</span> <span class="syntax-symbol">.</span> <span class="syntax-paren7">(<span class="syntax-symbol"><span class="syntax-string">"Patches"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>

</pre></div>

<p>There are three records for configuring the Patchwork service.  The
<code>&lt;patchwork-configuration&gt;</code> relates to the configuration for Patchwork
within the HTTPD service.
</p>
<p>The <code>settings-module</code> field within the <code>&lt;patchwork-configuration&gt;</code>
record can be populated with the <code>&lt;patchwork-settings-module&gt;</code> record,
which describes a settings module that is generated within the Guix store.
</p>
<p>For the <code>database-configuration</code> field within the
<code>&lt;patchwork-settings-module&gt;</code>, the
<code>&lt;patchwork-database-configuration&gt;</code> must be used.
</p>
<dl>
<dt id="index-patchwork_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">patchwork-configuration </span></dt>
<dd><p>Data type representing the Patchwork service configuration.  This type has the
following parameters:
</p>
<dl compact="compact">
<dt><code>patchwork</code> (default: <code>patchwork</code>)</dt>
<dd><p>The Patchwork package to use.
</p>
</dd>
<dt><code>domain</code></dt>
<dd><p>The domain to use for Patchwork, this is used in the HTTPD service virtual
host.
</p>
</dd>
<dt><code>settings-module</code></dt>
<dd><p>The settings module to use for Patchwork.  As a Django application, Patchwork
is configured with a Python module containing the settings.  This can either be
an instance of the <code>&lt;patchwork-settings-module&gt;</code> record, any other record
that represents the settings in the store, or a directory outside of the
store.
</p>
</dd>
<dt><code>static-path</code>  (default: <code>"/static/"</code>)</dt>
<dd><p>The path under which the HTTPD service should serve the static files.
</p>
</dd>
<dt><code>getmail-retriever-config</code></dt>
<dd><p>The getmail-retriever-configuration record value to use with
Patchwork.  Getmail will be configured with this value, the messages will be
delivered to Patchwork.
</p>
</dd>
</dl>
</dd></dl>

<dl>
<dt id="index-patchwork_002dsettings_002dmodule" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">patchwork-settings-module </span></dt>
<dd><p>Data type representing a settings module for Patchwork.  Some of these
settings relate directly to Patchwork, but others relate to Django, the web
framework used by Patchwork, or the Django Rest Framework library.  This type
has the following parameters:
</p>
<dl compact="compact">
<dt><code>database-configuration</code> (default: <code>(patchwork-database-configuration)</code>)</dt>
<dd><p>The database connection settings used for Patchwork.  See the
<code>&lt;patchwork-database-configuration&gt;</code> record type for more information.
</p>
</dd>
<dt><code>secret-key-file</code> (default: <code>"/etc/patchwork/django-secret-key"</code>)</dt>
<dd><p>Patchwork, as a Django web application uses a secret key for cryptographically
signing values.  This file should contain a unique unpredictable value.
</p>
<p>If this file does not exist, it will be created and populated with a random
value by the patchwork-setup shepherd service.
</p>
<p>This setting relates to Django.
</p>
</dd>
<dt><code>allowed-hosts</code></dt>
<dd><p>A list of valid hosts for this Patchwork service.  This should at least include
the domain specified in the <code>&lt;patchwork-configuration&gt;</code> record.
</p>
<p>This is a Django setting.
</p>
</dd>
<dt><code>default-from-email</code></dt>
<dd><p>The email address from which Patchwork should send email by default.
</p>
<p>This is a Patchwork setting.
</p>
</dd>
<dt><code>static-url</code> (default: <code>#f</code>)</dt>
<dd><p>The URL to use when serving static assets.  It can be part of a URL, or a full
URL, but must end in a <code>/</code>.
</p>
<p>If the default value is used, the <code>static-path</code> value from the
<code>&lt;patchwork-configuration&gt;</code> record will be used.
</p>
<p>This is a Django setting.
</p>
</dd>
<dt><code>admins</code> (default: <code>'()</code>)</dt>
<dd><p>Email addresses to send the details of errors that occur.  Each value should
be a list containing two elements, the name and then the email address.
</p>
<p>This is a Django setting.
</p>
</dd>
<dt><code>debug?</code> (default: <code>#f</code>)</dt>
<dd><p>Whether to run Patchwork in debug mode.  If set to <code>#t</code>, detailed error
messages will be shown.
</p>
<p>This is a Django setting.
</p>
</dd>
<dt><code>enable-rest-api?</code> (default: <code>#t</code>)</dt>
<dd><p>Whether to enable the Patchwork REST API.
</p>
<p>This is a Patchwork setting.
</p>
</dd>
<dt><code>enable-xmlrpc?</code> (default: <code>#t</code>)</dt>
<dd><p>Whether to enable the XML RPC API.
</p>
<p>This is a Patchwork setting.
</p>
</dd>
<dt><code>force-https-links?</code> (default: <code>#t</code>)</dt>
<dd><p>Whether to use HTTPS links on Patchwork pages.
</p>
<p>This is a Patchwork setting.
</p>
</dd>
<dt><code>extra-settings</code> (default: <code>""</code>)</dt>
<dd><p>Extra code to place at the end of the Patchwork settings module.
</p>
</dd>
</dl>
</dd></dl>

<dl>
<dt id="index-patchwork_002ddatabase_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">patchwork-database-configuration </span></dt>
<dd><p>Data type representing the database configuration for Patchwork.
</p>
<dl compact="compact">
<dt><code>engine</code> (default: <code>"django.db.backends.postgresql_psycopg2"</code>)</dt>
<dd><p>The database engine to use.
</p>
</dd>
<dt><code>name</code> (default: <code>"patchwork"</code>)</dt>
<dd><p>The name of the database to use.
</p>
</dd>
<dt><code>user</code> (default: <code>"httpd"</code>)</dt>
<dd><p>The user to connect to the database as.
</p>
</dd>
<dt><code>password</code> (default: <code>""</code>)</dt>
<dd><p>The password to use when connecting to the database.
</p>
</dd>
<dt><code>host</code> (default: <code>""</code>)</dt>
<dd><p>The host to make the database connection to.
</p>
</dd>
<dt><code>port</code> (default: <code>""</code>)</dt>
<dd><p>The port on which to connect to the database.
</p>
</dd>
</dl>
</dd></dl>

<span id="Mumi"></span><h4 class="subsubheading">Mumi</h4>

<span id="index-Mumi_002c-Debbugs-Web-interface"></span>
<span id="index-Debbugs_002c-Mumi-Web-interface"></span>
<p><a href="https://git.elephly.net/gitweb.cgi?p=software/mumi.git">Mumi</a> is a
Web interface to the Debbugs bug tracker, by default for
<a href="https://bugs.gnu.org">the GNU instance</a>.  Mumi is a Web server,
but it also fetches and indexes mail retrieved from Debbugs.
</p>
<dl>
<dt id="index-mumi_002dservice_002dtype" class="symbol-definition"><span class="symbol-definition-category">Scheme Variable: </span><span class="symbol-definition-prototype">mumi-service-type </span></dt>
<dd><p>This is the service type for Mumi.
</p></dd></dl>

<dl>
<dt id="index-mumi_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">mumi-configuration </span></dt>
<dd><p>Data type representing the Mumi service configuration.  This type has the
following fields:
</p>
<dl compact="compact">
<dt><code>mumi</code> (default: <code>mumi</code>)</dt>
<dd><p>The Mumi package to use.
</p>
</dd>
<dt><code>mailer?</code> (default: <code>#true</code>)</dt>
<dd><p>Whether to enable or disable the mailer component.
</p>
</dd>
<dt><code>mumi-configuration-sender</code></dt>
<dd><p>The email address used as the sender for comments.
</p>
</dd>
<dt><code>mumi-configuration-smtp</code></dt>
<dd><p>A URI to configure the SMTP settings for Mailutils.  This could be
something like <code>sendmail:///path/to/bin/msmtp</code> or any other URI
supported by Mailutils.  See <a href="https://www.gnu.org/software/mailutils/manual/html_node/SMTP-Mailboxes.html#SMTP-Mailboxes">SMTP Mailboxes</a> in <cite>GNU&nbsp;Mailutils</cite>.
</p>
</dd>
</dl>
</dd></dl>


<span id="FastCGI"></span><h4 class="subsubheading">FastCGI</h4>
<span id="index-fastcgi"></span>
<span id="index-fcgiwrap"></span>
<p>FastCGI is an interface between the front-end and the back-end of a web
service.  It is a somewhat legacy facility; new web services should
generally just talk HTTP between the front-end and the back-end.
However there are a number of back-end services such as PHP or the
optimized HTTP Git repository access that use FastCGI, so we have
support for it in Guix.
</p>
<p>To use FastCGI, you configure the front-end web server (e.g., nginx) to
dispatch some subset of its requests to the fastcgi backend, which
listens on a local TCP or UNIX socket.  There is an intermediary
<code>fcgiwrap</code> program that sits between the actual backend process and
the web server.  The front-end indicates which backend program to run,
passing that information to the <code>fcgiwrap</code> process.
</p>
<dl>
<dt id="index-fcgiwrap_002dservice_002dtype" class="symbol-definition"><span class="symbol-definition-category">Scheme Variable: </span><span class="symbol-definition-prototype">fcgiwrap-service-type </span></dt>
<dd><p>A service type for the <code>fcgiwrap</code> FastCGI proxy.
</p></dd></dl>

<dl>
<dt id="index-fcgiwrap_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">fcgiwrap-configuration </span></dt>
<dd><p>Data type representing the configuration of the <code>fcgiwrap</code> service.
This type has the following parameters:
</p><dl compact="compact">
<dt><code>package</code> (default: <code>fcgiwrap</code>)</dt>
<dd><p>The fcgiwrap package to use.
</p>
</dd>
<dt><code>socket</code> (default: <code>tcp:127.0.0.1:9000</code>)</dt>
<dd><p>The socket on which the <code>fcgiwrap</code> process should listen, as a
string.  Valid <var>socket</var> values include
<code>unix:<var>/path/to/unix/socket</var></code>,
<code>tcp:<var>dot.ted.qu.ad</var>:<var>port</var></code> and
<code>tcp6:[<var>ipv6_addr</var>]:port</code>.
</p>
</dd>
<dt><code>user</code> (default: <code>fcgiwrap</code>)</dt>
<dt><code>group</code> (default: <code>fcgiwrap</code>)</dt>
<dd><p>The user and group names, as strings, under which to run the
<code>fcgiwrap</code> process.  The <code>fastcgi</code> service will ensure that if
the user asks for the specific user or group names <code>fcgiwrap</code> that
the corresponding user and/or group is present on the system.
</p>
<p>It is possible to configure a FastCGI-backed web service to pass HTTP
authentication information from the front-end to the back-end, and to
allow <code>fcgiwrap</code> to run the back-end process as a corresponding
local user.  To enable this capability on the back-end, run
<code>fcgiwrap</code> as the <code>root</code> user and group.  Note that this
capability also has to be configured on the front-end as well.
</p></dd>
</dl>
</dd></dl>

<span id="PHP_002dFPM"></span><span id="PHP_002dFPM-1"></span><h4 class="subsubheading">PHP-FPM</h4>
<span id="index-php_002dfpm"></span>
<p>PHP-FPM (FastCGI Process Manager) is an alternative PHP FastCGI implementation
with some additional features useful for sites of any size.
</p>
<p>These features include:
</p><ul>
<li> Adaptive process spawning
</li><li> Basic statistics (similar to Apache&rsquo;s mod_status)
</li><li> Advanced process management with graceful stop/start
</li><li> Ability to start workers with different uid/gid/chroot/environment
and different php.ini (replaces safe_mode)
</li><li> Stdout &amp; stderr logging
</li><li> Emergency restart in case of accidental opcode cache destruction
</li><li> Accelerated upload support
</li><li> Support for a "slowlog"
</li><li> Enhancements to FastCGI, such as fastcgi_finish_request() -
a special function to finish request &amp; flush all data while continuing to do
something time-consuming (video converting, stats processing, etc.)
</li></ul>
<p>... and much more.
</p>
<dl>
<dt id="index-php_002dfpm_002dservice_002dtype" class="symbol-definition"><span class="symbol-definition-category">Scheme Variable: </span><span class="symbol-definition-prototype">php-fpm-service-type </span></dt>
<dd><p>A Service type for <code>php-fpm</code>.
</p></dd></dl>

<dl>
<dt id="index-php_002dfpm_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">php-fpm-configuration </span></dt>
<dd><p>Data Type for php-fpm service configuration.
</p><dl compact="compact">
<dt><code>php</code> (default: <code>php</code>)</dt>
<dd><p>The php package to use.
</p></dd>
<dt><code>socket</code> (default: <code>(string-append "/var/run/php" (version-major (package-version php)) "-fpm.sock")</code>)</dt>
<dd><p>The address on which to accept FastCGI requests.  Valid syntaxes are:
</p><dl compact="compact">
<dt><code>"ip.add.re.ss:port"</code></dt>
<dd><p>Listen on a TCP socket to a specific address on a specific port.
</p></dd>
<dt><code>"port"</code></dt>
<dd><p>Listen on a TCP socket to all addresses on a specific port.
</p></dd>
<dt><code>"/path/to/unix/socket"</code></dt>
<dd><p>Listen on a unix socket.
</p></dd>
</dl>

</dd>
<dt><code>user</code> (default: <code>php-fpm</code>)</dt>
<dd><p>User who will own the php worker processes.
</p></dd>
<dt><code>group</code> (default: <code>php-fpm</code>)</dt>
<dd><p>Group of the worker processes.
</p></dd>
<dt><code>socket-user</code> (default: <code>php-fpm</code>)</dt>
<dd><p>User who can speak to the php-fpm socket.
</p></dd>
<dt><code>socket-group</code> (default: <code>nginx</code>)</dt>
<dd><p>Group that can speak to the php-fpm socket.
</p></dd>
<dt><code>pid-file</code> (default: <code>(string-append "/var/run/php" (version-major (package-version php)) "-fpm.pid")</code>)</dt>
<dd><p>The process id of the php-fpm process is written to this file
once the service has started.
</p></dd>
<dt><code>log-file</code> (default: <code>(string-append "/var/log/php" (version-major (package-version php)) "-fpm.log")</code>)</dt>
<dd><p>Log for the php-fpm master process.
</p></dd>
<dt><code>process-manager</code> (default: <code>(php-fpm-dynamic-process-manager-configuration)</code>)</dt>
<dd><p>Detailed settings for the php-fpm process manager.
Must be one of:
</p><dl compact="compact">
<dt><code>&lt;php-fpm-dynamic-process-manager-configuration&gt;</code></dt>
<dt><code>&lt;php-fpm-static-process-manager-configuration&gt;</code></dt>
<dt><code>&lt;php-fpm-on-demand-process-manager-configuration&gt;</code></dt>
</dl>
</dd>
<dt><code>display-errors</code> (default <code>#f</code>)</dt>
<dd><p>Determines whether php errors and warning should be sent to clients
and displayed in their browsers.
This is useful for local php development, but a security risk for public sites,
as error messages can reveal passwords and personal data.
</p></dd>
<dt><code>timezone</code> (default <code>#f</code>)</dt>
<dd><p>Specifies <code>php_admin_value[date.timezone]</code> parameter.
</p></dd>
<dt><code>workers-logfile</code> (default <code>(string-append "/var/log/php" (version-major (package-version php)) "-fpm.www.log")</code>)</dt>
<dd><p>This file will log the <code>stderr</code> outputs of php worker processes.
Can be set to <code>#f</code> to disable logging.
</p></dd>
<dt><code>file</code> (default <code>#f</code>)</dt>
<dd><p>An optional override of the whole configuration.
You can use the <code>mixed-text-file</code> function or an absolute filepath for it.
</p></dd>
<dt><code>php-ini-file</code> (default <code>#f</code>)</dt>
<dd><p>An optional override of the default php settings.
It may be any &ldquo;file-like&rdquo; object (see <a href="G_002dExpressions.html">file-like objects</a>).
You can use the <code>mixed-text-file</code> function or an absolute filepath for it.
</p>
<p>For local development it is useful to set a higher timeout and memory
limit for spawned php processes.  This be accomplished with the
following operating system configuration snippet:
</p><div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-symbol">%local-php-ini</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="G_002dExpressions.html#index-plain_002dfile">plain-file</a> <span class="syntax-string">"php.ini"</span>
              <span class="syntax-string">"memory_limit = 2G
max_execution_time = 1800"</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="operating_002dsystem-Reference.html#index-operating_002dsystem-1">operating-system</a>
  <span class="syntax-comment">;; …
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">services</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Pairs.html#index-cons">cons</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Web-Services.html#index-php_002dfpm_002dservice_002dtype">php-fpm-service-type</a>
                           <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-php_002dfpm_002dconfiguration">php-fpm-configuration</a>
                            <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">php-ini-file</span> <span class="syntax-symbol">%local-php-ini</span></span>)</span></span>)</span></span>)</span>
                  <a class="syntax-symbol" href="Base-Services.html#index-_0025base_002dservices-1">%base-services</a></span>)</span></span>)</span></span>)</span>
</pre></div>

<p>Consult the <a href="https://www.php.net/manual/en/ini.core.php">core php.ini
directives</a> for comprehensive documentation on the acceptable
<samp>php.ini</samp> directives.
</p></dd>
</dl>
</dd></dl>

<dl>
<dt id="index-php_002dfpm_002ddynamic_002dprocess_002dmanager_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data type: </span><span class="symbol-definition-prototype">php-fpm-dynamic-process-manager-configuration </span></dt>
<dd><p>Data Type for the <code>dynamic</code> php-fpm process manager.  With the
<code>dynamic</code> process manager, spare worker processes are kept around
based on its configured limits.
</p><dl compact="compact">
<dt><code>max-children</code> (default: <code>5</code>)</dt>
<dd><p>Maximum of worker processes.
</p></dd>
<dt><code>start-servers</code> (default: <code>2</code>)</dt>
<dd><p>How many worker processes should be started on start-up.
</p></dd>
<dt><code>min-spare-servers</code> (default: <code>1</code>)</dt>
<dd><p>How many spare worker processes should be kept around at minimum.
</p></dd>
<dt><code>max-spare-servers</code> (default: <code>3</code>)</dt>
<dd><p>How many spare worker processes should be kept around at maximum.
</p></dd>
</dl>
</dd></dl>

<dl>
<dt id="index-php_002dfpm_002dstatic_002dprocess_002dmanager_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data type: </span><span class="symbol-definition-prototype">php-fpm-static-process-manager-configuration </span></dt>
<dd><p>Data Type for the <code>static</code> php-fpm process manager.  With the
<code>static</code> process manager, an unchanging number of worker processes
are created.
</p><dl compact="compact">
<dt><code>max-children</code> (default: <code>5</code>)</dt>
<dd><p>Maximum of worker processes.
</p></dd>
</dl>
</dd></dl>

<dl>
<dt id="index-php_002dfpm_002don_002ddemand_002dprocess_002dmanager_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data type: </span><span class="symbol-definition-prototype">php-fpm-on-demand-process-manager-configuration </span></dt>
<dd><p>Data Type for the <code>on-demand</code> php-fpm process manager.  With the
<code>on-demand</code> process manager, worker processes are only created as
requests arrive.
</p><dl compact="compact">
<dt><code>max-children</code> (default: <code>5</code>)</dt>
<dd><p>Maximum of worker processes.
</p></dd>
<dt><code>process-idle-timeout</code> (default: <code>10</code>)</dt>
<dd><p>The time in seconds after which a process with no requests is killed.
</p></dd>
</dl>
</dd></dl>


<dl>
<dt id="index-nginx_002dphp_002dlocation" class="symbol-definition"><span class="symbol-definition-category">Scheme Procedure: </span><span class="symbol-definition-prototype">nginx-php-location [#:nginx-package nginx]        [socket (string-append "/var/run/php"                               (version-major (package-version php))                               "-fpm.sock")]</span></dt>
<dd><p>A helper function to quickly add php to an <code>nginx-server-configuration</code>.
</p></dd></dl>

<p>A simple services setup for nginx with php can look like this:
</p><div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-symbol">services</span> <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-cons_002a">cons*</a> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Networking-Setup.html#index-dhcp_002dclient_002dservice_002dtype">dhcp-client-service-type</a></span>)</span>
                 <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Web-Services.html#index-php_002dfpm_002dservice_002dtype">php-fpm-service-type</a></span>)</span>
                 <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Web-Services.html#index-nginx_002dservice_002dtype">nginx-service-type</a>
                          <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-nginx_002dserver_002dconfiguration">nginx-server-configuration</a>
                           <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">server-name</span> <span class="syntax-symbol">'</span><span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-string">"example.com"</span></span>)</span></span>)</span>
                           <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">root</span> <span class="syntax-string">"/srv/http/"</span></span>)</span>
                           <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">locations</span>
                            <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren6">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-nginx_002dphp_002dlocation">nginx-php-location</a></span>)</span></span>)</span></span>)</span>
                           <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Network-Sockets-and-Communication.html#index-listen">listen</a> <span class="syntax-symbol">'</span><span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-string">"80"</span></span>)</span></span>)</span>
                           <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">ssl-certificate</span> <span class="syntax-symbol">#f</span></span>)</span>
                           <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">ssl-certificate-key</span> <span class="syntax-symbol">#f</span></span>)</span></span>)</span></span>)</span>
                 <a class="syntax-symbol" href="Base-Services.html#index-_0025base_002dservices-1">%base-services</a></span>)</span></span>)</span>
</pre></div>

<span id="index-cat_002davatar_002dgenerator"></span>
<p>The cat avatar generator is a simple service to demonstrate the use of php-fpm
in <code>Nginx</code>.  It is used to generate cat avatar from a seed, for instance
the hash of a user&rsquo;s email address.
</p>
<dl>
<dt id="index-cat_002davatar_002dgenerator_002dservice" class="symbol-definition"><span class="symbol-definition-category">Scheme Procedure: </span><span class="symbol-definition-prototype">cat-avatar-generator-service [#:cache-dir "/var/cache/cat-avatar-generator"]        [#:package cat-avatar-generator]        [#:configuration (nginx-server-configuration)]</span></dt>
<dd><p>Returns an nginx-server-configuration that inherits <code>configuration</code>.  It
extends the nginx configuration to add a server block that serves <code>package</code>,
a version of cat-avatar-generator.  During execution, cat-avatar-generator will
be able to use <code>cache-dir</code> as its cache directory.
</p></dd></dl>

<p>A simple setup for cat-avatar-generator can look like this:
</p><div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-symbol">services</span> <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-cons_002a">cons*</a> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-cat_002davatar_002dgenerator_002dservice">cat-avatar-generator-service</a>
                  <span class="syntax-keyword">#:configuration</span>
                  <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-nginx_002dserver_002dconfiguration">nginx-server-configuration</a>
                    <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">server-name</span> <span class="syntax-symbol">'</span><span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-string">"example.com"</span></span>)</span></span>)</span></span>)</span></span>)</span>
                 <a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Syntax-Rules.html#index-_002e_002e_002e">...</a>
                 <a class="syntax-symbol" href="Base-Services.html#index-_0025base_002dservices-1">%base-services</a></span>)</span></span>)</span>
</pre></div>

<span id="Hpcguix_002dweb"></span><h4 class="subsubheading">Hpcguix-web</h4>

<span id="index-hpcguix_002dweb"></span>
<p>The <a href="https://github.com/UMCUGenetics/hpcguix-web/">hpcguix-web</a>
program is a customizable web interface to browse Guix packages,
initially designed for users of high-performance computing (HPC)
clusters.
</p>
<dl>
<dt id="index-hpcguix_002dweb_002dservice_002dtype" class="symbol-definition"><span class="symbol-definition-category">Scheme Variable: </span><span class="symbol-definition-prototype">hpcguix-web-service-type </span></dt>
<dd><p>The service type for <code>hpcguix-web</code>.
</p></dd></dl>

<dl>
<dt id="index-hpcguix_002dweb_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">hpcguix-web-configuration </span></dt>
<dd><p>Data type for the hpcguix-web service configuration.
</p>
<dl compact="compact">
<dt><code>specs</code></dt>
<dd><p>A gexp (see <a href="G_002dExpressions.html">G-Expressions</a>) specifying the hpcguix-web service
configuration.  The main items available in this spec are:
</p>
<dl compact="compact">
<dt><code>title-prefix</code> (default: <code>"hpcguix | "</code>)</dt>
<dd><p>The page title prefix.
</p>
</dd>
<dt><code>guix-command</code> (default: <code>"guix"</code>)</dt>
<dd><p>The <code>guix</code> command.
</p>
</dd>
<dt><code>package-filter-proc</code> (default: <code>(const #t)</code>)</dt>
<dd><p>A procedure specifying how to filter packages that are displayed.
</p>
</dd>
<dt><code>package-page-extension-proc</code> (default: <code>(const '())</code>)</dt>
<dd><p>Extension package for <code>hpcguix-web</code>.
</p>
</dd>
<dt><code>menu</code> (default: <code>'()</code>)</dt>
<dd><p>Additional entry in page <code>menu</code>.
</p>
</dd>
<dt><code>channels</code> (default: <code>%default-channels</code>)</dt>
<dd><p>List of channels from which the package list is built (see <a href="Channels.html">Channels</a>).
</p>
</dd>
<dt><code>package-list-expiration</code> (default: <code>(* 12 3600)</code>)</dt>
<dd><p>The expiration time, in seconds, after which the package list is rebuilt from
the latest instances of the given channels.
</p></dd>
</dl>

<p>See the hpcguix-web repository for a
<a href="https://github.com/UMCUGenetics/hpcguix-web/blob/master/hpcweb-configuration.scm">complete example</a>.
</p>
</dd>
<dt><code>package</code> (default: <code>hpcguix-web</code>)</dt>
<dd><p>The hpcguix-web package to use.
</p>
</dd>
<dt><code>address</code> (default: <code>"127.0.0.1"</code>)</dt>
<dd><p>The IP address to listen to.
</p>
</dd>
<dt><code>port</code> (default: <code>5000</code>)</dt>
<dd><p>The port number to listen to.
</p></dd>
</dl>
</dd></dl>

<p>A typical hpcguix-web service declaration looks like this:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Web-Services.html#index-hpcguix_002dweb_002dservice_002dtype">hpcguix-web-service-type</a>
         <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-hpcguix_002dweb_002dconfiguration">hpcguix-web-configuration</a>
          <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">specs</span>
           <span class="syntax-symbol">#~</span><span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-symbol">site-config</span>
               <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">hpcweb-configuration</span>
                <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">title-prefix</span> <span class="syntax-string">"Guix-HPC - "</span></span>)</span>
                <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">menu</span> <span class="syntax-symbol">'</span><span class="syntax-paren6">(<span class="syntax-symbol"><span class="syntax-paren7">(<span class="syntax-symbol"><span class="syntax-string">"/about"</span> <span class="syntax-string">"ABOUT"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
</pre></div>

<blockquote>
<p><b>Note:</b> The hpcguix-web service periodically updates the package list it publishes by
pulling channels from Git.  To that end, it needs to access X.509 certificates
so that it can authenticate Git servers when communicating over HTTPS, and it
assumes that <samp>/etc/ssl/certs</samp> contains those certificates.
</p>
<p>Thus, make sure to add <code>nss-certs</code> or another certificate package to the
<code>packages</code> field of your configuration.  <a href="X_002e509-Certificates.html">X.509 Certificates</a>, for
more information on X.509 certificates.
</p></blockquote>

<span id="gmnisrv"></span><h4 class="subsubheading">gmnisrv</h4>

<span id="index-gmnisrv"></span>
<p>The <a href="https://git.sr.ht/~sircmpwn/gmnisrv">gmnisrv</a> program is a
simple <a href="https://gemini.circumlunar.space/">Gemini</a> protocol server.
</p>
<dl>
<dt id="index-gmnisrv_002dservice_002dtype" class="symbol-definition"><span class="symbol-definition-category">Scheme Variable: </span><span class="symbol-definition-prototype">gmnisrv-service-type </span></dt>
<dd><p>This is the type of the gmnisrv service, whose value should be a
<code>gmnisrv-configuration</code> object, as in this example:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Web-Services.html#index-gmnisrv_002dservice_002dtype">gmnisrv-service-type</a>
         <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-gmnisrv_002dconfiguration">gmnisrv-configuration</a>
           <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">config-file</span> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="G_002dExpressions.html#index-local_002dfile">local-file</a> <span class="syntax-string">"./my-gmnisrv.ini"</span></span>)</span></span>)</span></span>)</span></span>)</span>
</pre></div>
</dd></dl>

<dl>
<dt id="index-gmnisrv_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">gmnisrv-configuration </span></dt>
<dd><p>Data type representing the configuration of gmnisrv.
</p>
<dl compact="compact">
<dt><code>package</code> (default: <var>gmnisrv</var>)</dt>
<dd><p>Package object of the gmnisrv server.
</p>
</dd>
<dt><code>config-file</code> (default: <code>%default-gmnisrv-config-file</code>)</dt>
<dd><p>File-like object of the gmnisrv configuration file to use.  The default
configuration listens on port 1965 and serves files from
<samp>/srv/gemini</samp>.  Certificates are stored in
<samp>/var/lib/gemini/certs</samp>.  For more information, run <code>man
gmnisrv</code> and <code>man gmnisrv.ini</code>.
</p>
</dd>
</dl>
</dd></dl>

<span id="Agate"></span><h4 class="subsubheading">Agate</h4>

<span id="index-agate"></span>
<p>The <a href="gemini://qwertqwefsday.eu/agate.gmi">Agate</a>
(<a href="https://github.com/mbrubeck/agate">GitHub page over HTTPS</a>)
program is a simple <a href="https://gemini.circumlunar.space/">Gemini</a>
protocol server written in Rust.
</p>
<dl>
<dt id="index-agate_002dservice_002dtype" class="symbol-definition"><span class="symbol-definition-category">Scheme Variable: </span><span class="symbol-definition-prototype">agate-service-type </span></dt>
<dd><p>This is the type of the agate service, whose value should be an
<code>agate-service-type</code> object, as in this example:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Web-Services.html#index-agate_002dservice_002dtype">agate-service-type</a>
	 <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="Web-Services.html#index-agate_002dconfiguration">agate-configuration</a>
	   <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">content</span> <span class="syntax-string">"/srv/gemini"</span></span>)</span>
	   <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">cert</span> <span class="syntax-string">"/srv/cert.pem"</span></span>)</span>
	   <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">key</span> <span class="syntax-string">"/srv/key.rsa"</span></span>)</span></span>)</span></span>)</span>
</pre></div>

<p>The example above represents the minimal tweaking necessary to get Agate
up and running.  Specifying the path to the certificate and key is
always necessary, as the Gemini protocol requires TLS by default.
</p>
<p>To obtain a certificate and a key, you could, for example, use OpenSSL,
running a command similar to the following example:
</p>
<div class="example">
<pre class="example">openssl req -x509 -newkey rsa:4096 -keyout key.rsa -out cert.pem \
    -days 3650 -nodes -subj "/CN=example.com"
</pre></div>

<p>Of course, you&rsquo;ll have to replace <i>example.com</i> with your own domain
name, and then point the Agate configuration towards the path of the
generated key and certificate.
</p>
</dd></dl>

<dl>
<dt id="index-agate_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">agate-configuration </span></dt>
<dd><p>Data type representing the configuration of Agate.
</p>
<dl compact="compact">
<dt><code>package</code> (default: <code>agate</code>)</dt>
<dd><p>The package object of the Agate server.
</p>
</dd>
<dt><code>content</code> (default: <samp>"/srv/gemini"</samp>)</dt>
<dd><p>The directory from which Agate will serve files.
</p>
</dd>
<dt><code>cert</code> (default: <code>#f</code>)</dt>
<dd><p>The path to the TLS certificate PEM file to be used for encrypted
connections.  Must be filled in with a value from the user.
</p>
</dd>
<dt><code>key</code> (default: <code>#f</code>)</dt>
<dd><p>The path to the PKCS8 private key file to be used for encrypted
connections.  Must be filled in with a value from the user.
</p>
</dd>
<dt><code>addr</code> (default: <code>'("0.0.0.0:1965" "[::]:1965")</code>)</dt>
<dd><p>A list of the addresses to listen on.
</p>
</dd>
<dt><code>hostname</code> (default: <code>#f</code>)</dt>
<dd><p>The domain name of this Gemini server.  Optional.
</p>
</dd>
<dt><code>lang</code> (default: <code>#f</code>)</dt>
<dd><p>RFC 4646 language code(s) for text/gemini documents.  Optional.
</p>
</dd>
<dt><code>silent?</code> (default: <code>#f</code>)</dt>
<dd><p>Set to <code>#t</code> to disable logging output.
</p>
</dd>
<dt><code>serve-secret?</code> (default: <code>#f</code>)</dt>
<dd><p>Set to <code>#t</code> to serve secret files (files/directories starting with
a dot).
</p>
</dd>
<dt><code>log-ip?</code> (default: <code>#t</code>)</dt>
<dd><p>Whether or not to output IP addresses when logging.
</p>
</dd>
<dt><code>user</code> (default: <code>"agate"</code>)</dt>
<dd><p>Owner of the <code>agate</code> process.
</p>
</dd>
<dt><code>group</code> (default: <code>"agate"</code>)</dt>
<dd><p>Owner&rsquo;s group of the <code>agate</code> process.
</p>
</dd>
<dt><code>log-file</code> (default: <samp>"/var/log/agate.log"</samp>)</dt>
<dd><p>The file which should store the logging output of Agate.
</p>
</dd>
</dl>
</dd></dl>

<hr />
<div class="header">
<p>
Next: <a href="Certificate-Services.html" accesskey="n" rel="next">Certificate Services</a>, Previous: <a href="LDAP-Services.html" accesskey="p" rel="prev">LDAP Services</a>, Up: <a href="Services.html" accesskey="u" rel="up">Services</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
