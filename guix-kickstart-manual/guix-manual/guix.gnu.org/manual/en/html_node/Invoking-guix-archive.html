<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--   Copyright (C) 2012-2022 Ludovic Courtès

Copyright (C) 2013, 2014, 2016 Andreas Enge

Copyright (C) 2013 Nikita Karetnikov

Copyright (C) 2014, 2015, 2016 Alex Kost

Copyright (C) 2015, 2016 Mathieu Lirzin

Copyright (C) 2014 Pierre-Antoine Rault

Copyright (C) 2015 Taylan Ulrich Bayırlı/Kammer

Copyright (C) 2015, 2016, 2017, 2019, 2020, 2021 Leo Famulari

Copyright (C) 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022 Ricardo Wurmus

Copyright (C) 2016 Ben Woodcroft

Copyright (C) 2016, 2017, 2018, 2021 Chris Marusich

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021, 2022 Efraim Flashner

Copyright (C) 2016 John Darrington

Copyright (C) 2016, 2017 Nikita Gillmann

Copyright (C) 2016, 2017, 2018, 2019, 2020 Jan Nieuwenhuizen

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021 Julien Lepiller

Copyright (C) 2016 Alex ter Weele

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021 Christopher Baines

Copyright (C) 2017, 2018, 2019 Clément Lassieur

Copyright (C) 2017, 2018, 2020, 2021, 2022 Mathieu Othacehe

Copyright (C) 2017 Federico Beffa

Copyright (C) 2017, 2018 Carlo Zancanaro

Copyright (C) 2017 Thomas Danckaert

Copyright (C) 2017 humanitiesNerd

Copyright (C) 2017, 2021 Christine Lemmer-Webber

Copyright (C) 2017, 2018, 2019, 2020, 2021, 2022 Marius Bakke

Copyright (C) 2017, 2019, 2020, 2022 Hartmut Goebel

Copyright (C) 2017, 2019, 2020, 2021, 2022 Maxim Cournoyer

Copyright (C) 2017–2022 Tobias Geerinckx-Rice

Copyright (C) 2017 George Clemmer

Copyright (C) 2017 Andy Wingo

Copyright (C) 2017, 2018, 2019, 2020 Arun Isaac

Copyright (C) 2017 nee

Copyright (C) 2018 Rutger Helling

Copyright (C) 2018, 2021 Oleg Pykhalov

Copyright (C) 2018 Mike Gerwitz

Copyright (C) 2018 Pierre-Antoine Rouby

Copyright (C) 2018, 2019 Gábor Boskovits

Copyright (C) 2018, 2019, 2020, 2022 Florian Pelz

Copyright (C) 2018 Laura Lazzati

Copyright (C) 2018 Alex Vong

Copyright (C) 2019 Josh Holland

Copyright (C) 2019, 2020 Diego Nicola Barbato

Copyright (C) 2019 Ivan Petkov

Copyright (C) 2019 Jakob L. Kreuze

Copyright (C) 2019 Kyle Andrews

Copyright (C) 2019 Alex Griffin

Copyright (C) 2019, 2020, 2021, 2022 Guillaume Le Vaillant

Copyright (C) 2020 Liliana Marie Prikler

Copyright (C) 2019, 2020, 2021, 2022 Simon Tournier

Copyright (C) 2020 Wiktor Żelazny

Copyright (C) 2020 Damien Cassou

Copyright (C) 2020 Jakub Kądziołka

Copyright (C) 2020 Jack Hill

Copyright (C) 2020 Naga Malleswari

Copyright (C) 2020, 2021 Brice Waegeneire

Copyright (C) 2020 R Veera Kumar

Copyright (C) 2020, 2021 Pierre Langlois

Copyright (C) 2020 pinoaffe

Copyright (C) 2020 André Batista

Copyright (C) 2020, 2021 Alexandru-Sergiu Marton

Copyright (C) 2020 raingloom

Copyright (C) 2020 Daniel Brooks

Copyright (C) 2020 John Soo

Copyright (C) 2020 Jonathan Brielmaier

Copyright (C) 2020 Edgar Vincent

Copyright (C) 2021, 2022 Maxime Devos

Copyright (C) 2021 B. Wilson

Copyright (C) 2021 Xinglu Chen

Copyright (C) 2021 Raghav Gururajan

Copyright (C) 2021 Domagoj Stolfa

Copyright (C) 2021 Hui Lu

Copyright (C) 2021 pukkamustard

Copyright (C) 2021 Alice Brenon

Copyright (C) 2021, 2022 Josselin Poiret

Copyright (C) 2021 muradm

Copyright (C) 2021, 2022 Andrew Tropin

Copyright (C) 2021 Sarah Morgensen

Copyright (C) 2022 Remco van 't Veer

Copyright (C) 2022 Aleksandr Vityazev

Copyright (C) 2022 Philip McGrath

Copyright (C) 2022 Karl Hallsby

Copyright (C) 2022 Justin Veilleux

Copyright (C) 2022 Reily Siegel

Copyright (C) 2022 Simon Streit

Copyright (C) 2022 (

Copyright (C) 2022 John Kehayias


Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.  A
copy of the license is included in the section entitled "GNU Free
Documentation License".   -->
<!--   Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/   -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Invoking guix archive (GNU Guix Reference Manual)</title>

<meta name="description" content="Invoking guix archive (GNU Guix Reference Manual)" />
<meta name="keywords" content="Invoking guix archive (GNU Guix Reference Manual)" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="Generator" content="makeinfo" />
<link href="index.html" rel="start" title="Top" />
<link href="Concept-Index.html" rel="index" title="Concept Index" />
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents" />
<link href="Package-Management.html" rel="up" title="Package Management" />
<link href="Channels.html" rel="next" title="Channels" />
<link href="Invoking-guix-describe.html" rel="prev" title="Invoking guix describe" />
<style type="text/css">
&amp;lt;!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
--&amp;gt;
</style>
<link rel="stylesheet" type="text/css" href="https://www.gnu.org/software/gnulib/manual.css" />

<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" type="text/css" href="../../../static/base/css/manual.css" /><link rel="stylesheet" type="text/css" href="../../../static/base/css/code.css" /></head>

<body lang="en"><header class="navbar"><h1><a class="branding" href="https://guix.gnu.org/manual/en/"></a></h1><nav class="navbar-menu"><input class="navbar-menu-hidden-input" type="radio" name="dropdown" id="all-dropdowns-hidden" /><ul><li class="navbar-menu-item dropdown dropdown-btn"><input class="navbar-menu-hidden-input" type="radio" name="dropdown" id="visible-dropdown" /><label for="visible-dropdown"><img alt="Language" src="../../../static/base/img/language-picker.svg" /></label><label for="all-dropdowns-hidden"><img alt="Language" src="../../../static/base/img/language-picker.svg" /></label><div class="navbar-submenu" id="navbar-submenu"><div class="navbar-submenu-triangle"> </div><ul><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/de/html_node">Deutsch</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/en/html_node">English</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/es/html_node">Español</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/fr/html_node">français</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/pt-br/html_node">Português</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/ru/html_node">русский</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/zh-cn/html_node">中文</a></li><li><a class="navbar-menu-item" href="https://translate.fedoraproject.org/projects/guix/documentation-manual/">⊕</a></li></ul></div></li></ul></nav><a class="navbar-menu-btn" href="https://guix.gnu.org/manual/"></a></header>
<span id="Invoking-guix-archive"></span><div class="header">
<p>
Previous: <a href="Invoking-guix-describe.html" accesskey="p" rel="prev">Invoking guix describe</a>, Up: <a href="Package-Management.html" accesskey="u" rel="up">Package Management</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr />
<span id="Invoking-guix-archive-1"></span><h3 class="section">6.10 Invoking <code>guix archive</code></h3>

<span id="index-guix-archive"></span>
<span id="index-archive"></span>
<span id="index-exporting-files-from-the-store"></span>
<span id="index-importing-files-to-the-store"></span>
<p>The <code>guix archive</code> command allows users to <em>export</em> files
from the store into a single archive, and to later <em>import</em> them on
a machine that runs Guix.
In particular, it allows store files to be transferred from one machine
to the store on another machine.
</p>
<blockquote>
<p><b>Note:</b> If you&rsquo;re looking for a way to produce archives in a format suitable for
tools other than Guix, see <a href="Invoking-guix-pack.html">Invoking guix pack</a>.
</p></blockquote>

<span id="index-exporting-store-items"></span>
<p>To export store files as an archive to standard output, run:
</p>
<div class="example">
<pre class="example">guix archive --export <var>options</var> <var>specifications</var>...
</pre></div>

<p><var>specifications</var> may be either store file names or package
specifications, as for <code>guix package</code> (see <a href="Invoking-guix-package.html">Invoking guix package</a>).  For instance, the following command creates an archive
containing the <code>gui</code> output of the <code>git</code> package and the main
output of <code>emacs</code>:
</p>
<div class="example">
<pre class="example">guix archive --export git:gui /gnu/store/...-emacs-24.3 &gt; great.nar
</pre></div>

<p>If the specified packages are not built yet, <code>guix archive</code>
automatically builds them.  The build process may be controlled with the
common build options (see <a href="Common-Build-Options.html">Common Build Options</a>).
</p>
<p>To transfer the <code>emacs</code> package to a machine connected over SSH,
one would run:
</p>
<div class="example">
<pre class="example">guix archive --export -r emacs | ssh the-machine guix archive --import
</pre></div>

<p>Similarly, a complete user profile may be transferred from one machine
to another like this:
</p>
<div class="example">
<pre class="example">guix archive --export -r $(readlink -f ~/.guix-profile) | \
  ssh the-machine guix archive --import
</pre></div>

<p>However, note that, in both examples, all of <code>emacs</code> and the
profile as well as all of their dependencies are transferred (due to
<samp>-r</samp>), regardless of what is already available in the store on
the target machine.  The <samp>--missing</samp> option can help figure out
which items are missing from the target store.  The <code>guix copy</code>
command simplifies and optimizes this whole process, so this is probably
what you should use in this case (see <a href="Invoking-guix-copy.html">Invoking guix copy</a>).
</p>
<span id="index-nar_002c-archive-format"></span>
<span id="index-normalized-archive-_0028nar_0029"></span>
<span id="index-nar-bundle_002c-archive-format"></span>
<p>Each store item is written in the <em>normalized archive</em> or <em>nar</em>
format (described below), and the output of <code>guix archive
--export</code> (and input of <code>guix archive --import</code>) is a <em>nar
bundle</em>.
</p>
<p>The nar format is
comparable in spirit to &lsquo;tar&rsquo;, but with differences
that make it more appropriate for our purposes.  First, rather than
recording all Unix metadata for each file, the nar format only mentions
the file type (regular, directory, or symbolic link); Unix permissions
and owner/group are dismissed.  Second, the order in which directory
entries are stored always follows the order of file names according to
the C locale collation order.  This makes archive production fully
deterministic.
</p>
<p>That nar bundle format is essentially the concatenation of zero or more
nars along with metadata for each store item it contains: its file name,
references, corresponding derivation, and a digital signature.
</p>
<p>When exporting, the daemon digitally signs the contents of the archive,
and that digital signature is appended.  When importing, the daemon
verifies the signature and rejects the import in case of an invalid
signature or if the signing key is not authorized.
</p>
<p>The main options are:
</p>
<dl compact="compact">
<dt><code>--export</code></dt>
<dd><p>Export the specified store files or packages (see below).  Write the
resulting archive to the standard output.
</p>
<p>Dependencies are <em>not</em> included in the output, unless
<samp>--recursive</samp> is passed.
</p>
</dd>
<dt><code>-r</code></dt>
<dt><code>--recursive</code></dt>
<dd><p>When combined with <samp>--export</samp>, this instructs <code>guix archive</code>
to include dependencies of the given items in the archive.  Thus, the
resulting archive is self-contained: it contains the closure of the
exported store items.
</p>
</dd>
<dt><code>--import</code></dt>
<dd><p>Read an archive from the standard input, and import the files listed
therein into the store.  Abort if the archive has an invalid digital
signature, or if it is signed by a public key not among the authorized
keys (see <samp>--authorize</samp> below).
</p>
</dd>
<dt><code>--missing</code></dt>
<dd><p>Read a list of store file names from the standard input, one per line,
and write on the standard output the subset of these files missing from
the store.
</p>
</dd>
<dt><code>--generate-key[=<var>parameters</var>]</code></dt>
<dd><span id="index-signing_002c-archives"></span>
<p>Generate a new key pair for the daemon.  This is a prerequisite before
archives can be exported with <samp>--export</samp>.  This
operation is usually instantaneous but it can take time if the system&rsquo;s
entropy pool needs to be refilled.  On Guix System,
<code>guix-service-type</code> takes care of generating this key pair the
first boot.
</p>
<p>The generated key pair is typically stored under <samp>/etc/guix</samp>, in
<samp>signing-key.pub</samp> (public key) and <samp>signing-key.sec</samp> (private
key, which must be kept secret).  When <var>parameters</var> is omitted,
an ECDSA key using the Ed25519 curve is generated, or, for Libgcrypt
versions before 1.6.0, it is a 4096-bit RSA key.
Alternatively, <var>parameters</var> can specify
<code>genkey</code> parameters suitable for Libgcrypt (see <a href="https://www.gnupg.org/documentation/manuals/gcrypt/General-public_002dkey-related-Functions.html#General-public_002dkey-related-Functions"><code>gcry_pk_genkey</code></a> in <cite>The
Libgcrypt Reference Manual</cite>).
</p>
</dd>
<dt><code>--authorize</code></dt>
<dd><span id="index-authorizing_002c-archives"></span>
<p>Authorize imports signed by the public key passed on standard input.
The public key must be in &ldquo;s-expression advanced format&rdquo;&mdash;i.e., the
same format as the <samp>signing-key.pub</samp> file.
</p>
<p>The list of authorized keys is kept in the human-editable file
<samp>/etc/guix/acl</samp>.  The file contains
<a href="https://people.csail.mit.edu/rivest/Sexp.txt">&ldquo;advanced-format
s-expressions&rdquo;</a> and is structured as an access-control list in the
<a href="https://theworld.com/~cme/spki.txt">Simple Public-Key Infrastructure
(SPKI)</a>.
</p>
</dd>
<dt><code>--extract=<var>directory</var></code></dt>
<dt><code>-x <var>directory</var></code></dt>
<dd><p>Read a single-item archive as served by substitute servers
(see <a href="Substitutes.html">Substitutes</a>) and extract it to <var>directory</var>.  This is a
low-level operation needed in only very narrow use cases; see below.
</p>
<p>For example, the following command extracts the substitute for Emacs
served by <code>ci.guix.gnu.org</code> to <samp>/tmp/emacs</samp>:
</p>
<div class="example">
<pre class="example">$ wget -O - \
  https://ci.guix.gnu.org/nar/gzip/&hellip;-emacs-24.5 \
  | gunzip | guix archive -x /tmp/emacs
</pre></div>

<p>Single-item archives are different from multiple-item archives produced
by <code>guix archive --export</code>; they contain a single store item,
and they do <em>not</em> embed a signature.  Thus this operation does
<em>no</em> signature verification and its output should be considered
unsafe.
</p>
<p>The primary purpose of this operation is to facilitate inspection of
archive contents coming from possibly untrusted substitute servers
(see <a href="Invoking-guix-challenge.html">Invoking guix challenge</a>).
</p>
</dd>
<dt><code>--list</code></dt>
<dt><code>-t</code></dt>
<dd><p>Read a single-item archive as served by substitute servers
(see <a href="Substitutes.html">Substitutes</a>) and print the list of files it contains, as in
this example:
</p>
<div class="example">
<pre class="example">$ wget -O - \
  https://ci.guix.gnu.org/nar/lzip/&hellip;-emacs-26.3 \
  | lzip -d | guix archive -t
</pre></div>

</dd>
</dl>

<hr />
<div class="header">
<p>
Previous: <a href="Invoking-guix-describe.html" accesskey="p" rel="prev">Invoking guix describe</a>, Up: <a href="Package-Management.html" accesskey="u" rel="up">Package Management</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
