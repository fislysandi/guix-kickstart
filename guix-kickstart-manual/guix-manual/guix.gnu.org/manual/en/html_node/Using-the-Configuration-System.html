<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--   Copyright (C) 2012-2022 Ludovic Courtès

Copyright (C) 2013, 2014, 2016 Andreas Enge

Copyright (C) 2013 Nikita Karetnikov

Copyright (C) 2014, 2015, 2016 Alex Kost

Copyright (C) 2015, 2016 Mathieu Lirzin

Copyright (C) 2014 Pierre-Antoine Rault

Copyright (C) 2015 Taylan Ulrich Bayırlı/Kammer

Copyright (C) 2015, 2016, 2017, 2019, 2020, 2021 Leo Famulari

Copyright (C) 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022 Ricardo Wurmus

Copyright (C) 2016 Ben Woodcroft

Copyright (C) 2016, 2017, 2018, 2021 Chris Marusich

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021, 2022 Efraim Flashner

Copyright (C) 2016 John Darrington

Copyright (C) 2016, 2017 Nikita Gillmann

Copyright (C) 2016, 2017, 2018, 2019, 2020 Jan Nieuwenhuizen

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021 Julien Lepiller

Copyright (C) 2016 Alex ter Weele

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021 Christopher Baines

Copyright (C) 2017, 2018, 2019 Clément Lassieur

Copyright (C) 2017, 2018, 2020, 2021, 2022 Mathieu Othacehe

Copyright (C) 2017 Federico Beffa

Copyright (C) 2017, 2018 Carlo Zancanaro

Copyright (C) 2017 Thomas Danckaert

Copyright (C) 2017 humanitiesNerd

Copyright (C) 2017, 2021 Christine Lemmer-Webber

Copyright (C) 2017, 2018, 2019, 2020, 2021, 2022 Marius Bakke

Copyright (C) 2017, 2019, 2020, 2022 Hartmut Goebel

Copyright (C) 2017, 2019, 2020, 2021, 2022 Maxim Cournoyer

Copyright (C) 2017–2022 Tobias Geerinckx-Rice

Copyright (C) 2017 George Clemmer

Copyright (C) 2017 Andy Wingo

Copyright (C) 2017, 2018, 2019, 2020 Arun Isaac

Copyright (C) 2017 nee

Copyright (C) 2018 Rutger Helling

Copyright (C) 2018, 2021 Oleg Pykhalov

Copyright (C) 2018 Mike Gerwitz

Copyright (C) 2018 Pierre-Antoine Rouby

Copyright (C) 2018, 2019 Gábor Boskovits

Copyright (C) 2018, 2019, 2020, 2022 Florian Pelz

Copyright (C) 2018 Laura Lazzati

Copyright (C) 2018 Alex Vong

Copyright (C) 2019 Josh Holland

Copyright (C) 2019, 2020 Diego Nicola Barbato

Copyright (C) 2019 Ivan Petkov

Copyright (C) 2019 Jakob L. Kreuze

Copyright (C) 2019 Kyle Andrews

Copyright (C) 2019 Alex Griffin

Copyright (C) 2019, 2020, 2021, 2022 Guillaume Le Vaillant

Copyright (C) 2020 Liliana Marie Prikler

Copyright (C) 2019, 2020, 2021, 2022 Simon Tournier

Copyright (C) 2020 Wiktor Żelazny

Copyright (C) 2020 Damien Cassou

Copyright (C) 2020 Jakub Kądziołka

Copyright (C) 2020 Jack Hill

Copyright (C) 2020 Naga Malleswari

Copyright (C) 2020, 2021 Brice Waegeneire

Copyright (C) 2020 R Veera Kumar

Copyright (C) 2020, 2021 Pierre Langlois

Copyright (C) 2020 pinoaffe

Copyright (C) 2020 André Batista

Copyright (C) 2020, 2021 Alexandru-Sergiu Marton

Copyright (C) 2020 raingloom

Copyright (C) 2020 Daniel Brooks

Copyright (C) 2020 John Soo

Copyright (C) 2020 Jonathan Brielmaier

Copyright (C) 2020 Edgar Vincent

Copyright (C) 2021, 2022 Maxime Devos

Copyright (C) 2021 B. Wilson

Copyright (C) 2021 Xinglu Chen

Copyright (C) 2021 Raghav Gururajan

Copyright (C) 2021 Domagoj Stolfa

Copyright (C) 2021 Hui Lu

Copyright (C) 2021 pukkamustard

Copyright (C) 2021 Alice Brenon

Copyright (C) 2021, 2022 Josselin Poiret

Copyright (C) 2021 muradm

Copyright (C) 2021, 2022 Andrew Tropin

Copyright (C) 2021 Sarah Morgensen

Copyright (C) 2022 Remco van 't Veer

Copyright (C) 2022 Aleksandr Vityazev

Copyright (C) 2022 Philip McGrath

Copyright (C) 2022 Karl Hallsby

Copyright (C) 2022 Justin Veilleux

Copyright (C) 2022 Reily Siegel

Copyright (C) 2022 Simon Streit

Copyright (C) 2022 (

Copyright (C) 2022 John Kehayias


Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.  A
copy of the license is included in the section entitled "GNU Free
Documentation License".   -->
<!--   Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/   -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Using the Configuration System (GNU Guix Reference Manual)</title>

<meta name="description" content="Using the Configuration System (GNU Guix Reference Manual)" />
<meta name="keywords" content="Using the Configuration System (GNU Guix Reference Manual)" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="Generator" content="makeinfo" />
<link href="index.html" rel="start" title="Top" />
<link href="Concept-Index.html" rel="index" title="Concept Index" />
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents" />
<link href="System-Configuration.html" rel="up" title="System Configuration" />
<link href="operating_002dsystem-Reference.html" rel="next" title="operating-system Reference" />
<link href="System-Configuration.html" rel="prev" title="System Configuration" />
<style type="text/css">
&amp;lt;!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
--&amp;gt;
</style>
<link rel="stylesheet" type="text/css" href="https://www.gnu.org/software/gnulib/manual.css" />

<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" type="text/css" href="../../../static/base/css/manual.css" /><link rel="stylesheet" type="text/css" href="../../../static/base/css/code.css" /></head>

<body lang="en"><header class="navbar"><h1><a class="branding" href="https://guix.gnu.org/manual/en/"></a></h1><nav class="navbar-menu"><input class="navbar-menu-hidden-input" type="radio" name="dropdown" id="all-dropdowns-hidden" /><ul><li class="navbar-menu-item dropdown dropdown-btn"><input class="navbar-menu-hidden-input" type="radio" name="dropdown" id="visible-dropdown" /><label for="visible-dropdown"><img alt="Language" src="../../../static/base/img/language-picker.svg" /></label><label for="all-dropdowns-hidden"><img alt="Language" src="../../../static/base/img/language-picker.svg" /></label><div class="navbar-submenu" id="navbar-submenu"><div class="navbar-submenu-triangle"> </div><ul><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/de/html_node">Deutsch</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/en/html_node">English</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/es/html_node">Español</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/fr/html_node">français</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/pt-br/html_node">Português</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/ru/html_node">русский</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/zh-cn/html_node">中文</a></li><li><a class="navbar-menu-item" href="https://translate.fedoraproject.org/projects/guix/documentation-manual/">⊕</a></li></ul></div></li></ul></nav><a class="navbar-menu-btn" href="https://guix.gnu.org/manual/"></a></header>
<span id="Using-the-Configuration-System"></span><div class="header">
<p>
Next: <a href="operating_002dsystem-Reference.html" accesskey="n" rel="next">operating-system Reference</a>, Up: <a href="System-Configuration.html" accesskey="u" rel="up">System Configuration</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr />
<span id="Using-the-Configuration-System-1"></span><h3 class="section">12.1 Using the Configuration System</h3>

<p>The operating system is configured by providing an
<code>operating-system</code> declaration in a file that can then be passed to
the <code>guix system</code> command (see <a href="Invoking-guix-system.html">Invoking guix system</a>).  A
simple setup, with the default system services, the default Linux-Libre
kernel, initial RAM disk, and boot loader looks like this:
</p>
<span id="index-operating_002dsystem"></span>
<div class="lisp">
<pre class="lisp"><span class="syntax-comment">;; This is an operating system configuration template
</span><span class="syntax-comment">;; for a "bare bones" setup, with no X11 display server.
</span>
<span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Using-Guile-Modules.html#index-use_002dmodules">use-modules</a> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">gnu</span></span>)</span></span>)</span>
<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-symbol">use-service-modules</span> <span class="syntax-symbol">networking</span> <span class="syntax-symbol">ssh</span></span>)</span>
<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-symbol">use-package-modules</span> <span class="syntax-symbol">screen</span> <span class="syntax-symbol">ssh</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="operating_002dsystem-Reference.html#index-operating_002dsystem-1">operating-system</a>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">host-name</span> <span class="syntax-string">"komputilo"</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">timezone</span> <span class="syntax-string">"Europe/Berlin"</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">locale</span> <span class="syntax-string">"en_US.utf8"</span></span>)</span>

  <span class="syntax-comment">;; Boot in "legacy" BIOS mode, assuming /dev/sdX is the
</span>  <span class="syntax-comment">;; target hard disk, and "my-root" is the label of the target
</span>  <span class="syntax-comment">;; root file system.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">bootloader</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="Bootloader-Configuration.html#index-bootloader_002dconfiguration">bootloader-configuration</a>
                <span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-symbol">bootloader</span> <span class="syntax-symbol">grub-bootloader</span></span>)</span>
                <span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-symbol">targets</span> <span class="syntax-symbol">'</span><span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-string">"/dev/sdX"</span></span>)</span></span>)</span></span>)</span></span>)</span>
  <span class="syntax-comment">;; It's fitting to support the equally bare bones ‘-nographic’
</span>  <span class="syntax-comment">;; QEMU option, which also nicely sidesteps forcing QWERTY.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">kernel-arguments</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-string">"console=ttyS0,115200"</span></span>)</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">file-systems</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Pairs.html#index-cons">cons</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="File-Systems.html#index-file_002dsystem">file-system</a>
                        <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">device</span> <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="File-Systems.html#index-file_002dsystem_002dlabel-1">file-system-label</a> <span class="syntax-string">"my-root"</span></span>)</span></span>)</span>
                        <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">mount-point</span> <span class="syntax-string">"/"</span></span>)</span>
                        <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">type</span> <span class="syntax-string">"ext4"</span></span>)</span></span>)</span>
                      <a class="syntax-symbol" href="File-Systems.html#index-_0025base_002dfile_002dsystems">%base-file-systems</a></span>)</span></span>)</span>

  <span class="syntax-comment">;; This is where user accounts are specified.  The "root"
</span>  <span class="syntax-comment">;; account is implicit, and is initially created with the
</span>  <span class="syntax-comment">;; empty password.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">users</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Pairs.html#index-cons">cons</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="User-Accounts.html#index-user_002daccount">user-account</a>
                <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">name</span> <span class="syntax-string">"alice"</span></span>)</span>
                <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">comment</span> <span class="syntax-string">"Bob's sister"</span></span>)</span>
                <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">group</span> <span class="syntax-string">"users"</span></span>)</span>

                <span class="syntax-comment">;; Adding the account to the "wheel" group
</span>                <span class="syntax-comment">;; makes it a sudoer.  Adding it to "audio"
</span>                <span class="syntax-comment">;; and "video" allows the user to play sound
</span>                <span class="syntax-comment">;; and access the webcam.
</span>                <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">supplementary-groups</span> <span class="syntax-symbol">'</span><span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-string">"wheel"</span>
                                        <span class="syntax-string">"audio"</span> <span class="syntax-string">"video"</span></span>)</span></span>)</span></span>)</span>
               <a class="syntax-symbol" href="User-Accounts.html#index-_0025base_002duser_002daccounts">%base-user-accounts</a></span>)</span></span>)</span>

  <span class="syntax-comment">;; Globally-installed packages.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">packages</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Pairs.html#index-cons">cons</a> <span class="syntax-symbol">screen</span> <span class="syntax-symbol">%base-packages</span></span>)</span></span>)</span>

  <span class="syntax-comment">;; Add services to the baseline: a DHCP client and
</span>  <span class="syntax-comment">;; an SSH server.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">services</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Append_002fReverse.html#index-append">append</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Networking-Setup.html#index-dhcp_002dclient_002dservice_002dtype">dhcp-client-service-type</a></span>)</span>
                          <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Networking-Services.html#index-openssh_002dservice_002dtype">openssh-service-type</a>
                                   <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="Networking-Services.html#index-openssh_002dconfiguration">openssh-configuration</a>
                                    <span class="syntax-paren6">(<span class="syntax-symbol"><span class="syntax-symbol">openssh</span> <span class="syntax-symbol">openssh-sans-x</span></span>)</span>
                                    <span class="syntax-paren6">(<span class="syntax-symbol"><span class="syntax-symbol">port-number</span> <span class="syntax-symbol">2222</span></span>)</span></span>)</span></span>)</span></span>)</span>
                    <a class="syntax-symbol" href="Base-Services.html#index-_0025base_002dservices-1">%base-services</a></span>)</span></span>)</span></span>)</span>
</pre></div>

<p>This example should be self-describing.  Some of the fields defined
above, such as <code>host-name</code> and <code>bootloader</code>, are mandatory.
Others, such as <code>packages</code> and <code>services</code>, can be omitted, in
which case they get a default value.
</p>
<p>Below we discuss the effect of some of the most important fields
(see <a href="operating_002dsystem-Reference.html">operating-system Reference</a>, for details about all the available
fields), and how to <em>instantiate</em> the operating system using
<code>guix system</code>.
</p>
<span id="Bootloader"></span><h4 class="unnumberedsubsec">Bootloader</h4>

<span id="index-legacy-boot_002c-on-Intel-machines"></span>
<span id="index-BIOS-boot_002c-on-Intel-machines"></span>
<span id="index-UEFI-boot"></span>
<span id="index-EFI-boot"></span>
<p>The <code>bootloader</code> field describes the method that will be used to boot
your system.  Machines based on Intel processors can boot in &ldquo;legacy&rdquo; BIOS
mode, as in the example above.  However, more recent machines rely instead on
the <em>Unified Extensible Firmware Interface</em> (UEFI) to boot.  In that case,
the <code>bootloader</code> field should contain something along these lines:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Bootloader-Configuration.html#index-bootloader_002dconfiguration">bootloader-configuration</a>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">bootloader</span> <span class="syntax-symbol">grub-efi-bootloader</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">targets</span> <span class="syntax-symbol">'</span><span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-string">"/boot/efi"</span></span>)</span></span>)</span></span>)</span>
</pre></div>

<p>See <a href="Bootloader-Configuration.html">Bootloader Configuration</a>, for more information on the available
configuration options.
</p>
<span id="Globally_002dVisible-Packages"></span><h4 class="unnumberedsubsec">Globally-Visible Packages</h4>

<span id="index-_0025base_002dpackages"></span>
<p>The <code>packages</code> field lists packages that will be globally visible
on the system, for all user accounts&mdash;i.e., in every user&rsquo;s <code>PATH</code>
environment variable&mdash;in addition to the per-user profiles
(see <a href="Invoking-guix-package.html">Invoking guix package</a>).  The <code>%base-packages</code> variable
provides all the tools one would expect for basic user and administrator
tasks&mdash;including the GNU Core Utilities, the GNU Networking Utilities,
the <code>mg</code> lightweight text editor, <code>find</code>, <code>grep</code>,
etc.  The example above adds GNU&nbsp;Screen to those,
taken from the <code>(gnu packages screen)</code>
module (see <a href="Package-Modules.html">Package Modules</a>).  The
<code>(list package output)</code> syntax can be used to add a specific output
of a package:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Using-Guile-Modules.html#index-use_002dmodules">use-modules</a> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">gnu</span> <span class="syntax-symbol">packages</span></span>)</span></span>)</span>
<span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Using-Guile-Modules.html#index-use_002dmodules">use-modules</a> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">gnu</span> <span class="syntax-symbol">packages</span> <span class="syntax-symbol">dns</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="operating_002dsystem-Reference.html#index-operating_002dsystem-1">operating-system</a>
  <span class="syntax-comment">;; ...
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">packages</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Pairs.html#index-cons">cons</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-symbol">isc-bind</span> <span class="syntax-string">"utils"</span></span>)</span>
                  <span class="syntax-symbol">%base-packages</span></span>)</span></span>)</span></span>)</span>
</pre></div>

<span id="index-specification_002d_003epackage"></span>
<p>Referring to packages by variable name, like <code>isc-bind</code> above, has
the advantage of being unambiguous; it also allows typos and such to be
diagnosed right away as &ldquo;unbound variables&rdquo;.  The downside is that one
needs to know which module defines which package, and to augment the
<code>use-package-modules</code> line accordingly.  To avoid that, one can use
the <code>specification-&gt;package</code> procedure of the <code>(gnu packages)</code>
module, which returns the best package for a given name or name and
version:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Using-Guile-Modules.html#index-use_002dmodules">use-modules</a> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">gnu</span> <span class="syntax-symbol">packages</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="operating_002dsystem-Reference.html#index-operating_002dsystem-1">operating-system</a>
  <span class="syntax-comment">;; ...
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">packages</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Append_002fReverse.html#index-append">append</a> <span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-special">map</span> <span class="syntax-symbol">specification-&gt;package</span>
                         <span class="syntax-symbol">'</span><span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-string">"tcpdump"</span> <span class="syntax-string">"htop"</span> <span class="syntax-string">"gnupg@2.0"</span></span>)</span></span>)</span>
                    <span class="syntax-symbol">%base-packages</span></span>)</span></span>)</span></span>)</span>
</pre></div>

<span id="System-Services"></span><h4 class="unnumberedsubsec">System Services</h4>

<span id="index-services"></span>
<span id="index-_0025base_002dservices"></span>
<p>The <code>services</code> field lists <em>system services</em> to be made
available when the system starts (see <a href="Services.html">Services</a>).
The <code>operating-system</code> declaration above specifies that, in
addition to the basic services, we want the OpenSSH secure shell
daemon listening on port 2222 (see <a href="Networking-Services.html"><code>openssh-service-type</code></a>).  Under the hood,
<code>openssh-service-type</code> arranges so that <code>sshd</code> is started with the
right command-line options, possibly with supporting configuration files
generated as needed (see <a href="Defining-Services.html">Defining Services</a>).
</p>
<span id="index-customization_002c-of-services"></span>
<span id="index-modify_002dservices"></span>
<p>Occasionally, instead of using the base services as is, you will want to
customize them.  To do this, use <code>modify-services</code> (see <a href="Service-Reference.html"><code>modify-services</code></a>) to modify the list.
</p>
<span id="auto_002dlogin-to-TTY"></span><p>For example, suppose you want to modify
<code>guix-daemon</code> and Mingetty (the console log-in) in the
<code>%base-services</code> list (see <a href="Base-Services.html"><code>%base-services</code></a>).  To do that, you can write the following in
your operating system declaration:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-symbol">%my-services</span>
  <span class="syntax-comment">;; My very own list of services.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-modify_002dservices-1">modify-services</a> <a class="syntax-symbol" href="Base-Services.html#index-_0025base_002dservices-1">%base-services</a>
    <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="Base-Services.html#index-guix_002dservice_002dtype">guix-service-type</a> <span class="syntax-symbol">config</span> <a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Syntax-Rules.html#index-_003d_003e">=&gt;</a>
                       <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="Base-Services.html#index-guix_002dconfiguration">guix-configuration</a>
                        <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">inherit</span> <span class="syntax-symbol">config</span></span>)</span>
                        <span class="syntax-comment">;; Fetch substitutes from example.org.
</span>                        <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">substitute-urls</span>
                          <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-string">"https://example.org/guix"</span>
                                <span class="syntax-string">"https://ci.guix.gnu.org"</span></span>)</span></span>)</span></span>)</span></span>)</span>
    <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">mingetty-service-type</span> <span class="syntax-symbol">config</span> <a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Syntax-Rules.html#index-_003d_003e">=&gt;</a>
                           <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="Base-Services.html#index-mingetty_002dconfiguration">mingetty-configuration</a>
                            <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">inherit</span> <span class="syntax-symbol">config</span></span>)</span>
                            <span class="syntax-comment">;; Automatically log in as "guest".
</span>                            <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">auto-login</span> <span class="syntax-string">"guest"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="operating_002dsystem-Reference.html#index-operating_002dsystem-1">operating-system</a>
  <span class="syntax-comment">;; …
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">services</span> <span class="syntax-symbol">%my-services</span></span>)</span></span>)</span>
</pre></div>

<p>This changes the configuration&mdash;i.e., the service parameters&mdash;of the
<code>guix-service-type</code> instance, and that of all the
<code>mingetty-service-type</code> instances in the <code>%base-services</code> list
(see <a href="https://guix.gnu.org/cookbook/en/html_node/Auto_002dLogin-to-a-Specific-TTY.html#Auto_002dLogin-to-a-Specific-TTY">see the cookbook for how to
auto-login one user to a specific TTY</a> in <cite>GNU Guix Cookbook</cite>)).
Observe how this is accomplished: first, we arrange for the original
configuration to be bound to the identifier <code>config</code> in the
<var>body</var>, and then we write the <var>body</var> so that it evaluates to the
desired configuration.  In particular, notice how we use <code>inherit</code>
to create a new configuration which has the same values as the old
configuration, but with a few modifications.
</p>
<span id="index-encrypted-disk-1"></span>
<p>The configuration for a typical &ldquo;desktop&rdquo; usage, with an encrypted
root partition, a swap file on the root partition, the X11 display
server, GNOME and Xfce (users can choose which of these desktop
environments to use at the log-in screen by pressing <kbd>F1</kbd>), network
management, power management, and more, would look like this:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-comment">;; This is an operating system configuration template
</span><span class="syntax-comment">;; for a "desktop" setup with GNOME and Xfce where the
</span><span class="syntax-comment">;; root partition is encrypted with LUKS, and a swap file.
</span>
<span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Using-Guile-Modules.html#index-use_002dmodules">use-modules</a> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">gnu</span></span>)</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">gnu</span> <a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Processes.html#index-system">system</a> <span class="syntax-symbol">nss</span></span>)</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">guix</span> <span class="syntax-symbol">utils</span></span>)</span></span>)</span>
<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-symbol">use-service-modules</span> <span class="syntax-symbol">desktop</span> <span class="syntax-symbol">sddm</span> <span class="syntax-symbol">xorg</span></span>)</span>
<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-symbol">use-package-modules</span> <span class="syntax-symbol">certs</span> <span class="syntax-symbol">gnome</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="operating_002dsystem-Reference.html#index-operating_002dsystem-1">operating-system</a>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">host-name</span> <span class="syntax-string">"antelope"</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">timezone</span> <span class="syntax-string">"Europe/Paris"</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">locale</span> <span class="syntax-string">"en_US.utf8"</span></span>)</span>

  <span class="syntax-comment">;; Choose US English keyboard layout.  The "altgr-intl"
</span>  <span class="syntax-comment">;; variant provides dead keys for accented characters.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="Keyboard-Layout.html#index-keyboard_002dlayout">keyboard-layout</a> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="Keyboard-Layout.html#index-keyboard_002dlayout">keyboard-layout</a> <span class="syntax-string">"us"</span> <span class="syntax-string">"altgr-intl"</span></span>)</span></span>)</span>

  <span class="syntax-comment">;; Use the UEFI variant of GRUB with the EFI System
</span>  <span class="syntax-comment">;; Partition mounted on /boot/efi.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">bootloader</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="Bootloader-Configuration.html#index-bootloader_002dconfiguration">bootloader-configuration</a>
                <span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-symbol">bootloader</span> <span class="syntax-symbol">grub-efi-bootloader</span></span>)</span>
                <span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-symbol">targets</span> <span class="syntax-symbol">'</span><span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-string">"/boot/efi"</span></span>)</span></span>)</span>
                <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="Keyboard-Layout.html#index-keyboard_002dlayout">keyboard-layout</a> <a class="syntax-symbol" href="Keyboard-Layout.html#index-keyboard_002dlayout">keyboard-layout</a></span>)</span></span>)</span></span>)</span>

  <span class="syntax-comment">;; Specify a mapped device for the encrypted root partition.
</span>  <span class="syntax-comment">;; The UUID is that returned by 'cryptsetup luksUUID'.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">mapped-devices</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="Mapped-Devices.html#index-mapped_002ddevice">mapped-device</a>
          <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">source</span> <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="File-Systems.html#index-uuid-1">uuid</a> <span class="syntax-string">"12345678-1234-1234-1234-123456789abc"</span></span>)</span></span>)</span>
          <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">target</span> <span class="syntax-string">"my-root"</span></span>)</span>
          <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">type</span> <a class="syntax-symbol" href="Mapped-Devices.html#index-luks_002ddevice_002dmapping">luks-device-mapping</a></span>)</span></span>)</span></span>)</span></span>)</span>

  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">file-systems</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Append_002fReverse.html#index-append">append</a>
                 <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="File-Systems.html#index-file_002dsystem">file-system</a>
                         <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">device</span> <span class="syntax-paren6">(<span class="syntax-symbol"><a class="syntax-symbol" href="File-Systems.html#index-file_002dsystem_002dlabel-1">file-system-label</a> <span class="syntax-string">"my-root"</span></span>)</span></span>)</span>
                         <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">mount-point</span> <span class="syntax-string">"/"</span></span>)</span>
                         <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">type</span> <span class="syntax-string">"ext4"</span></span>)</span>
                         <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">dependencies</span> <span class="syntax-symbol">mapped-devices</span></span>)</span></span>)</span>
                       <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="File-Systems.html#index-file_002dsystem">file-system</a>
                         <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">device</span> <span class="syntax-paren6">(<span class="syntax-symbol"><a class="syntax-symbol" href="File-Systems.html#index-uuid-1">uuid</a> <span class="syntax-string">"1234-ABCD"</span> <span class="syntax-symbol">'fat</span></span>)</span></span>)</span>
                         <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">mount-point</span> <span class="syntax-string">"/boot/efi"</span></span>)</span>
                         <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">type</span> <span class="syntax-string">"vfat"</span></span>)</span></span>)</span></span>)</span>
                 <a class="syntax-symbol" href="File-Systems.html#index-_0025base_002dfile_002dsystems">%base-file-systems</a></span>)</span></span>)</span>

  <span class="syntax-comment">;; Specify a swap file for the system, which resides on the
</span>  <span class="syntax-comment">;; root file system.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">swap-devices</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="Swap-Space.html#index-swap_002dspace">swap-space</a>
                       <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">target</span> <span class="syntax-string">"/swapfile"</span></span>)</span></span>)</span></span>)</span></span>)</span>

  <span class="syntax-comment">;; Create user `bob' with `alice' as its initial password.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">users</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Pairs.html#index-cons">cons</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="User-Accounts.html#index-user_002daccount">user-account</a>
                <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">name</span> <span class="syntax-string">"bob"</span></span>)</span>
                <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">comment</span> <span class="syntax-string">"Alice's brother"</span></span>)</span>
                <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">password</span> <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Encryption.html#index-crypt">crypt</a> <span class="syntax-string">"alice"</span> <span class="syntax-string">"$6$abc"</span></span>)</span></span>)</span>
                <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">group</span> <span class="syntax-string">"students"</span></span>)</span>
                <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">supplementary-groups</span> <span class="syntax-symbol">'</span><span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-string">"wheel"</span> <span class="syntax-string">"netdev"</span>
                                        <span class="syntax-string">"audio"</span> <span class="syntax-string">"video"</span></span>)</span></span>)</span></span>)</span>
               <a class="syntax-symbol" href="User-Accounts.html#index-_0025base_002duser_002daccounts">%base-user-accounts</a></span>)</span></span>)</span>

  <span class="syntax-comment">;; Add the `students' group
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">groups</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-cons_002a">cons*</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="User-Accounts.html#index-user_002dgroup">user-group</a>
                  <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">name</span> <span class="syntax-string">"students"</span></span>)</span></span>)</span>
                 <a class="syntax-symbol" href="User-Accounts.html#index-_0025base_002dgroups">%base-groups</a></span>)</span></span>)</span>

  <span class="syntax-comment">;; This is where we specify system-wide packages.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">packages</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Append_002fReverse.html#index-append">append</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a>
                     <span class="syntax-comment">;; for HTTPS access
</span>                     <span class="syntax-symbol">nss-certs</span>
                     <span class="syntax-comment">;; for user mounts
</span>                     <span class="syntax-symbol">gvfs</span></span>)</span>
                    <span class="syntax-symbol">%base-packages</span></span>)</span></span>)</span>

  <span class="syntax-comment">;; Add GNOME and Xfce---we can choose at the log-in screen
</span>  <span class="syntax-comment">;; by clicking the gear.  Use the "desktop" services, which
</span>  <span class="syntax-comment">;; include the X11 log-in service, networking with
</span>  <span class="syntax-comment">;; NetworkManager, and more.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">services</span> <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-special">if</span> <span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-symbol">target-x86-64?</span></span>)</span>
                <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Append_002fReverse.html#index-append">append</a> <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Desktop-Services.html#index-gnome_002ddesktop_002dservice_002dtype">gnome-desktop-service-type</a></span>)</span>
                              <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Desktop-Services.html#index-xfce_002ddesktop_002dservice_002dtype">xfce-desktop-service-type</a></span>)</span>
                              <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="X-Window.html#index-set_002dxorg_002dconfiguration-1">set-xorg-configuration</a>
                               <span class="syntax-paren6">(<span class="syntax-symbol"><a class="syntax-symbol" href="X-Window.html#index-xorg_002dconfiguration">xorg-configuration</a>
                                <span class="syntax-paren7">(<span class="syntax-symbol"><a class="syntax-symbol" href="Keyboard-Layout.html#index-keyboard_002dlayout">keyboard-layout</a> <a class="syntax-symbol" href="Keyboard-Layout.html#index-keyboard_002dlayout">keyboard-layout</a></span>)</span></span>)</span></span>)</span></span>)</span>
                        <a class="syntax-symbol" href="Desktop-Services.html#index-_0025desktop_002dservices">%desktop-services</a></span>)</span>

                <span class="syntax-comment">;; FIXME: Since GDM depends on Rust (gdm -&gt; gnome-shell -&gt; gjs
</span>                <span class="syntax-comment">;; -&gt; mozjs -&gt; rust) and Rust is currently unavailable on
</span>                <span class="syntax-comment">;; non-x86_64 platforms, we use SDDM and Mate here instead of
</span>                <span class="syntax-comment">;; GNOME and GDM.
</span>                <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Append_002fReverse.html#index-append">append</a> <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Desktop-Services.html#index-mate_002ddesktop_002dservice_002dtype">mate-desktop-service-type</a></span>)</span>
                              <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Desktop-Services.html#index-xfce_002ddesktop_002dservice_002dtype">xfce-desktop-service-type</a></span>)</span>
                              <span class="syntax-paren5">(<span class="syntax-symbol"><a class="syntax-symbol" href="X-Window.html#index-set_002dxorg_002dconfiguration-1">set-xorg-configuration</a>
                               <span class="syntax-paren6">(<span class="syntax-symbol"><a class="syntax-symbol" href="X-Window.html#index-xorg_002dconfiguration">xorg-configuration</a>
                                <span class="syntax-paren7">(<span class="syntax-symbol"><a class="syntax-symbol" href="Keyboard-Layout.html#index-keyboard_002dlayout">keyboard-layout</a> <a class="syntax-symbol" href="Keyboard-Layout.html#index-keyboard_002dlayout">keyboard-layout</a></span>)</span></span>)</span>
                               <a class="syntax-symbol" href="X-Window.html#index-sddm_002dservice_002dtype">sddm-service-type</a></span>)</span></span>)</span>
                        <a class="syntax-symbol" href="Desktop-Services.html#index-_0025desktop_002dservices">%desktop-services</a></span>)</span></span>)</span></span>)</span>

  <span class="syntax-comment">;; Allow resolution of '.local' host names with mDNS.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="Name-Service-Switch.html#index-name_002dservice_002dswitch">name-service-switch</a> <a class="syntax-symbol" href="Name-Service-Switch.html#index-_0025mdns_002dhost_002dlookup_002dnss">%mdns-host-lookup-nss</a></span>)</span></span>)</span>
</pre></div>

<p>A graphical system with a choice of lightweight window managers
instead of full-blown desktop environments would look like this:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-comment">;; This is an operating system configuration template
</span><span class="syntax-comment">;; for a "desktop" setup without full-blown desktop
</span><span class="syntax-comment">;; environments.
</span>
<span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Using-Guile-Modules.html#index-use_002dmodules">use-modules</a> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">gnu</span></span>)</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">gnu</span> <a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Processes.html#index-system">system</a> <span class="syntax-symbol">nss</span></span>)</span></span>)</span>
<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-symbol">use-service-modules</span> <span class="syntax-symbol">desktop</span></span>)</span>
<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-symbol">use-package-modules</span> <span class="syntax-symbol">bootloaders</span> <span class="syntax-symbol">certs</span> <span class="syntax-symbol">emacs</span> <span class="syntax-symbol">emacs-xyz</span> <span class="syntax-symbol">ratpoison</span> <span class="syntax-symbol">suckless</span> <span class="syntax-symbol">wm</span>
                     <span class="syntax-symbol">xorg</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="operating_002dsystem-Reference.html#index-operating_002dsystem-1">operating-system</a>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">host-name</span> <span class="syntax-string">"antelope"</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">timezone</span> <span class="syntax-string">"Europe/Paris"</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">locale</span> <span class="syntax-string">"en_US.utf8"</span></span>)</span>

  <span class="syntax-comment">;; Use the UEFI variant of GRUB with the EFI System
</span>  <span class="syntax-comment">;; Partition mounted on /boot/efi.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">bootloader</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="Bootloader-Configuration.html#index-bootloader_002dconfiguration">bootloader-configuration</a>
                <span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-symbol">bootloader</span> <span class="syntax-symbol">grub-efi-bootloader</span></span>)</span>
                <span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-symbol">targets</span> <span class="syntax-symbol">'</span><span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-string">"/boot/efi"</span></span>)</span></span>)</span></span>)</span></span>)</span>

  <span class="syntax-comment">;; Assume the target root file system is labelled "my-root",
</span>  <span class="syntax-comment">;; and the EFI System Partition has UUID 1234-ABCD.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">file-systems</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Append_002fReverse.html#index-append">append</a>
                 <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="File-Systems.html#index-file_002dsystem">file-system</a>
                         <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">device</span> <span class="syntax-paren6">(<span class="syntax-symbol"><a class="syntax-symbol" href="File-Systems.html#index-file_002dsystem_002dlabel-1">file-system-label</a> <span class="syntax-string">"my-root"</span></span>)</span></span>)</span>
                         <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">mount-point</span> <span class="syntax-string">"/"</span></span>)</span>
                         <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">type</span> <span class="syntax-string">"ext4"</span></span>)</span></span>)</span>
                       <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="File-Systems.html#index-file_002dsystem">file-system</a>
                         <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">device</span> <span class="syntax-paren6">(<span class="syntax-symbol"><a class="syntax-symbol" href="File-Systems.html#index-uuid-1">uuid</a> <span class="syntax-string">"1234-ABCD"</span> <span class="syntax-symbol">'fat</span></span>)</span></span>)</span>
                         <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">mount-point</span> <span class="syntax-string">"/boot/efi"</span></span>)</span>
                         <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">type</span> <span class="syntax-string">"vfat"</span></span>)</span></span>)</span></span>)</span>
                 <a class="syntax-symbol" href="File-Systems.html#index-_0025base_002dfile_002dsystems">%base-file-systems</a></span>)</span></span>)</span>

  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">users</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Pairs.html#index-cons">cons</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="User-Accounts.html#index-user_002daccount">user-account</a>
                <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">name</span> <span class="syntax-string">"alice"</span></span>)</span>
                <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">comment</span> <span class="syntax-string">"Bob's sister"</span></span>)</span>
                <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">group</span> <span class="syntax-string">"users"</span></span>)</span>
                <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">supplementary-groups</span> <span class="syntax-symbol">'</span><span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-string">"wheel"</span> <span class="syntax-string">"netdev"</span>
                                        <span class="syntax-string">"audio"</span> <span class="syntax-string">"video"</span></span>)</span></span>)</span></span>)</span>
               <a class="syntax-symbol" href="User-Accounts.html#index-_0025base_002duser_002daccounts">%base-user-accounts</a></span>)</span></span>)</span>

  <span class="syntax-comment">;; Add a bunch of window managers; we can choose one at
</span>  <span class="syntax-comment">;; the log-in screen with F1.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">packages</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Append_002fReverse.html#index-append">append</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a>
                     <span class="syntax-comment">;; window managers
</span>                     <span class="syntax-symbol">ratpoison</span> <span class="syntax-symbol">i3-wm</span> <span class="syntax-symbol">i3status</span> <span class="syntax-symbol">dmenu</span>
                     <span class="syntax-symbol">emacs</span> <span class="syntax-symbol">emacs-exwm</span> <span class="syntax-symbol">emacs-desktop-environment</span>
                     <span class="syntax-comment">;; terminal emulator
</span>                     <span class="syntax-symbol">xterm</span>
                     <span class="syntax-comment">;; for HTTPS access
</span>                     <span class="syntax-symbol">nss-certs</span></span>)</span>
                    <span class="syntax-symbol">%base-packages</span></span>)</span></span>)</span>

  <span class="syntax-comment">;; Use the "desktop" services, which include the X11
</span>  <span class="syntax-comment">;; log-in service, networking with NetworkManager, and more.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">services</span> <a class="syntax-symbol" href="Desktop-Services.html#index-_0025desktop_002dservices">%desktop-services</a></span>)</span>

  <span class="syntax-comment">;; Allow resolution of '.local' host names with mDNS.
</span>  <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="Name-Service-Switch.html#index-name_002dservice_002dswitch">name-service-switch</a> <a class="syntax-symbol" href="Name-Service-Switch.html#index-_0025mdns_002dhost_002dlookup_002dnss">%mdns-host-lookup-nss</a></span>)</span></span>)</span>
</pre></div>

<p>This example refers to the <samp>/boot/efi</samp> file system by its UUID,
<code>1234-ABCD</code>.  Replace this UUID with the right UUID on your system,
as returned by the <code>blkid</code> command.
</p>
<p>See <a href="Desktop-Services.html">Desktop Services</a>, for the exact list of services provided by
<code>%desktop-services</code>.  See <a href="X_002e509-Certificates.html">X.509 Certificates</a>, for background
information about the <code>nss-certs</code> package that is used here.
</p>
<p>Again, <code>%desktop-services</code> is just a list of service objects.  If
you want to remove services from there, you can do so using the
procedures for list filtering (see <a href="https://www.gnu.org/software/guile/manual/html_node/SRFI_002d1-Filtering-and-Partitioning.html#SRFI_002d1-Filtering-and-Partitioning">SRFI-1 Filtering and
Partitioning</a> in <cite>GNU Guile Reference Manual</cite>).  For instance, the
following expression returns a list that contains all the services in
<code>%desktop-services</code> minus the Avahi service:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/SRFI_002d1-Filtering-and-Partitioning.html#index-remove">remove</a> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-special">lambda</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a></span>)</span>
          <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Equality.html#index-eq_003f">eq?</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service_002dkind">service-kind</a> <a class="syntax-symbol" href="Service-Reference.html#index-service">service</a></span>)</span> <a class="syntax-symbol" href="Networking-Services.html#index-avahi_002dservice_002dtype">avahi-service-type</a></span>)</span></span>)</span>
        <a class="syntax-symbol" href="Desktop-Services.html#index-_0025desktop_002dservices">%desktop-services</a></span>)</span>
</pre></div>

<p>Alternatively, the <code>modify-services</code> macro can be used:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-modify_002dservices-1">modify-services</a> <a class="syntax-symbol" href="Desktop-Services.html#index-_0025desktop_002dservices">%desktop-services</a>
  <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Modification.html#index-delete">delete</a> <a class="syntax-symbol" href="Networking-Services.html#index-avahi_002dservice_002dtype">avahi-service-type</a></span>)</span></span>)</span>
</pre></div>


<span id="Instantiating-the-System"></span><h4 class="unnumberedsubsec">Instantiating the System</h4>

<p>Assuming the <code>operating-system</code> declaration
is stored in the <samp>my-system-config.scm</samp>
file, the <code>guix system reconfigure my-system-config.scm</code> command
instantiates that configuration, and makes it the default GRUB boot
entry (see <a href="Invoking-guix-system.html">Invoking guix system</a>).
</p>
<blockquote>
<p><b>Note:</b> We recommend that you keep this <samp>my-system-config.scm</samp> file safe
and under version control to easily track changes to your configuration.
</p></blockquote>

<p>The normal way to change the system configuration is by updating this
file and re-running <code>guix system reconfigure</code>.  One should never
have to touch files in <samp>/etc</samp> or to run commands that modify the
system state such as <code>useradd</code> or <code>grub-install</code>.  In
fact, you must avoid that since that would not only void your warranty
but also prevent you from rolling back to previous versions of your
system, should you ever need to.
</p>
<span id="index-roll_002dback_002c-of-the-operating-system"></span>
<p>Speaking of roll-back, each time you run <code>guix system
reconfigure</code>, a new <em>generation</em> of the system is created&mdash;without
modifying or deleting previous generations.  Old system generations get
an entry in the bootloader boot menu, allowing you to boot them in case
something went wrong with the latest generation.  Reassuring, no?  The
<code>guix system list-generations</code> command lists the system
generations available on disk.  It is also possible to roll back the
system via the commands <code>guix system roll-back</code> and
<code>guix system switch-generation</code>.
</p>
<p>Although the <code>guix system reconfigure</code> command will not modify
previous generations, you must take care when the current generation is not
the latest (e.g., after invoking <code>guix system roll-back</code>), since
the operation might overwrite a later generation (see <a href="Invoking-guix-system.html">Invoking guix system</a>).
</p>
<span id="The-Programming-Interface"></span><h4 class="unnumberedsubsec">The Programming Interface</h4>

<p>At the Scheme level, the bulk of an <code>operating-system</code> declaration
is instantiated with the following monadic procedure (see <a href="The-Store-Monad.html">The Store Monad</a>):
</p>
<dl>
<dt id="index-operating_002dsystem_002dderivation" class="symbol-definition"><span class="symbol-definition-category">Monadic Procedure: </span><span class="symbol-definition-prototype">operating-system-derivation os</span></dt>
<dd><p>Return a derivation that builds <var>os</var>, an <code>operating-system</code>
object (see <a href="Derivations.html">Derivations</a>).
</p>
<p>The output of the derivation is a single directory that refers to all
the packages, configuration files, and other supporting files needed to
instantiate <var>os</var>.
</p></dd></dl>

<p>This procedure is provided by the <code>(gnu system)</code> module.  Along
with <code>(gnu services)</code> (see <a href="Services.html">Services</a>), this module contains the
guts of Guix System.  Make sure to visit it!
</p>

<hr />
<div class="header">
<p>
Next: <a href="operating_002dsystem-Reference.html" accesskey="n" rel="next">operating-system Reference</a>, Up: <a href="System-Configuration.html" accesskey="u" rel="up">System Configuration</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
