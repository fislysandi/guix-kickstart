<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--   Copyright (C) 2012-2022 Ludovic Courtès

Copyright (C) 2013, 2014, 2016 Andreas Enge

Copyright (C) 2013 Nikita Karetnikov

Copyright (C) 2014, 2015, 2016 Alex Kost

Copyright (C) 2015, 2016 Mathieu Lirzin

Copyright (C) 2014 Pierre-Antoine Rault

Copyright (C) 2015 Taylan Ulrich Bayırlı/Kammer

Copyright (C) 2015, 2016, 2017, 2019, 2020, 2021 Leo Famulari

Copyright (C) 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022 Ricardo Wurmus

Copyright (C) 2016 Ben Woodcroft

Copyright (C) 2016, 2017, 2018, 2021 Chris Marusich

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021, 2022 Efraim Flashner

Copyright (C) 2016 John Darrington

Copyright (C) 2016, 2017 Nikita Gillmann

Copyright (C) 2016, 2017, 2018, 2019, 2020 Jan Nieuwenhuizen

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021 Julien Lepiller

Copyright (C) 2016 Alex ter Weele

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021 Christopher Baines

Copyright (C) 2017, 2018, 2019 Clément Lassieur

Copyright (C) 2017, 2018, 2020, 2021, 2022 Mathieu Othacehe

Copyright (C) 2017 Federico Beffa

Copyright (C) 2017, 2018 Carlo Zancanaro

Copyright (C) 2017 Thomas Danckaert

Copyright (C) 2017 humanitiesNerd

Copyright (C) 2017, 2021 Christine Lemmer-Webber

Copyright (C) 2017, 2018, 2019, 2020, 2021, 2022 Marius Bakke

Copyright (C) 2017, 2019, 2020, 2022 Hartmut Goebel

Copyright (C) 2017, 2019, 2020, 2021, 2022 Maxim Cournoyer

Copyright (C) 2017–2022 Tobias Geerinckx-Rice

Copyright (C) 2017 George Clemmer

Copyright (C) 2017 Andy Wingo

Copyright (C) 2017, 2018, 2019, 2020 Arun Isaac

Copyright (C) 2017 nee

Copyright (C) 2018 Rutger Helling

Copyright (C) 2018, 2021 Oleg Pykhalov

Copyright (C) 2018 Mike Gerwitz

Copyright (C) 2018 Pierre-Antoine Rouby

Copyright (C) 2018, 2019 Gábor Boskovits

Copyright (C) 2018, 2019, 2020, 2022 Florian Pelz

Copyright (C) 2018 Laura Lazzati

Copyright (C) 2018 Alex Vong

Copyright (C) 2019 Josh Holland

Copyright (C) 2019, 2020 Diego Nicola Barbato

Copyright (C) 2019 Ivan Petkov

Copyright (C) 2019 Jakob L. Kreuze

Copyright (C) 2019 Kyle Andrews

Copyright (C) 2019 Alex Griffin

Copyright (C) 2019, 2020, 2021, 2022 Guillaume Le Vaillant

Copyright (C) 2020 Liliana Marie Prikler

Copyright (C) 2019, 2020, 2021, 2022 Simon Tournier

Copyright (C) 2020 Wiktor Żelazny

Copyright (C) 2020 Damien Cassou

Copyright (C) 2020 Jakub Kądziołka

Copyright (C) 2020 Jack Hill

Copyright (C) 2020 Naga Malleswari

Copyright (C) 2020, 2021 Brice Waegeneire

Copyright (C) 2020 R Veera Kumar

Copyright (C) 2020, 2021 Pierre Langlois

Copyright (C) 2020 pinoaffe

Copyright (C) 2020 André Batista

Copyright (C) 2020, 2021 Alexandru-Sergiu Marton

Copyright (C) 2020 raingloom

Copyright (C) 2020 Daniel Brooks

Copyright (C) 2020 John Soo

Copyright (C) 2020 Jonathan Brielmaier

Copyright (C) 2020 Edgar Vincent

Copyright (C) 2021, 2022 Maxime Devos

Copyright (C) 2021 B. Wilson

Copyright (C) 2021 Xinglu Chen

Copyright (C) 2021 Raghav Gururajan

Copyright (C) 2021 Domagoj Stolfa

Copyright (C) 2021 Hui Lu

Copyright (C) 2021 pukkamustard

Copyright (C) 2021 Alice Brenon

Copyright (C) 2021, 2022 Josselin Poiret

Copyright (C) 2021 muradm

Copyright (C) 2021, 2022 Andrew Tropin

Copyright (C) 2021 Sarah Morgensen

Copyright (C) 2022 Remco van 't Veer

Copyright (C) 2022 Aleksandr Vityazev

Copyright (C) 2022 Philip McGrath

Copyright (C) 2022 Karl Hallsby

Copyright (C) 2022 Justin Veilleux

Copyright (C) 2022 Reily Siegel

Copyright (C) 2022 Simon Streit

Copyright (C) 2022 (

Copyright (C) 2022 John Kehayias


Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.  A
copy of the license is included in the section entitled "GNU Free
Documentation License".   -->
<!--   Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/   -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>The Store (GNU Guix Reference Manual)</title>

<meta name="description" content="The Store (GNU Guix Reference Manual)" />
<meta name="keywords" content="The Store (GNU Guix Reference Manual)" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="Generator" content="makeinfo" />
<link href="index.html" rel="start" title="Top" />
<link href="Concept-Index.html" rel="index" title="Concept Index" />
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents" />
<link href="Programming-Interface.html" rel="up" title="Programming Interface" />
<link href="Derivations.html" rel="next" title="Derivations" />
<link href="Search-Paths.html" rel="prev" title="Search Paths" />
<style type="text/css">
&amp;lt;!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
--&amp;gt;
</style>
<link rel="stylesheet" type="text/css" href="https://www.gnu.org/software/gnulib/manual.css" />

<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" type="text/css" href="../../../static/base/css/manual.css" /><link rel="stylesheet" type="text/css" href="../../../static/base/css/code.css" /></head>

<body lang="en"><header class="navbar"><h1><a class="branding" href="https://guix.gnu.org/manual/en/"></a></h1><nav class="navbar-menu"><input class="navbar-menu-hidden-input" type="radio" name="dropdown" id="all-dropdowns-hidden" /><ul><li class="navbar-menu-item dropdown dropdown-btn"><input class="navbar-menu-hidden-input" type="radio" name="dropdown" id="visible-dropdown" /><label for="visible-dropdown"><img alt="Language" src="../../../static/base/img/language-picker.svg" /></label><label for="all-dropdowns-hidden"><img alt="Language" src="../../../static/base/img/language-picker.svg" /></label><div class="navbar-submenu" id="navbar-submenu"><div class="navbar-submenu-triangle"> </div><ul><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/de/html_node">Deutsch</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/en/html_node">English</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/es/html_node">Español</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/fr/html_node">français</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/pt-br/html_node">Português</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/ru/html_node">русский</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/zh-cn/html_node">中文</a></li><li><a class="navbar-menu-item" href="https://translate.fedoraproject.org/projects/guix/documentation-manual/">⊕</a></li></ul></div></li></ul></nav><a class="navbar-menu-btn" href="https://guix.gnu.org/manual/"></a></header>
<span id="The-Store"></span><div class="header">
<p>
Next: <a href="Derivations.html" accesskey="n" rel="next">Derivations</a>, Previous: <a href="Search-Paths.html" accesskey="p" rel="prev">Search Paths</a>, Up: <a href="Programming-Interface.html" accesskey="u" rel="up">Programming Interface</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr />
<span id="The-Store-1"></span><h3 class="section">9.9 The Store</h3>

<span id="index-store-1"></span>
<span id="index-store-items"></span>
<span id="index-store-paths"></span>

<p>Conceptually, the <em>store</em> is the place where derivations that have
been built successfully are stored&mdash;by default, <samp>/gnu/store</samp>.
Sub-directories in the store are referred to as <em>store items</em> or
sometimes <em>store paths</em>.  The store has an associated database that
contains information such as the store paths referred to by each store
path, and the list of <em>valid</em> store items&mdash;results of successful
builds.  This database resides in <samp><var>localstatedir</var>/guix/db</samp>,
where <var>localstatedir</var> is the state directory specified <i>via</i>
<samp>--localstatedir</samp> at configure time, usually <samp>/var</samp>.
</p>
<p>The store is <em>always</em> accessed by the daemon on behalf of its clients
(see <a href="Invoking-guix_002ddaemon.html">Invoking guix-daemon</a>).  To manipulate the store, clients
connect to the daemon over a Unix-domain socket, send requests to it,
and read the result&mdash;these are remote procedure calls, or RPCs.
</p>
<blockquote>
<p><b>Note:</b> Users must <em>never</em> modify files under <samp>/gnu/store</samp> directly.
This would lead to inconsistencies and break the immutability
assumptions of Guix&rsquo;s functional model (see <a href="Introduction.html">Introduction</a>).
</p>
<p>See <a href="Invoking-guix-gc.html"><code>guix gc --verify</code></a>, for information on
how to check the integrity of the store and attempt recovery from
accidental modifications.
</p></blockquote>

<p>The <code>(guix store)</code> module provides procedures to connect to the
daemon, and to perform RPCs.  These are described below.  By default,
<code>open-connection</code>, and thus all the <code>guix</code> commands,
connect to the local daemon or to the URI specified by the
<code>GUIX_DAEMON_SOCKET</code> environment variable.
</p>
<dl>
<dt id="index-GUIX_005fDAEMON_005fSOCKET" class="symbol-definition"><span class="symbol-definition-category">Environment Variable: </span><span class="symbol-definition-prototype">GUIX_DAEMON_SOCKET </span></dt>
<dd><p>When set, the value of this variable should be a file name or a URI
designating the daemon endpoint.  When it is a file name, it denotes a
Unix-domain socket to connect to.  In addition to file names, the
supported URI schemes are:
</p>
<dl compact="compact">
<dt><code>file</code></dt>
<dt><code>unix</code></dt>
<dd><p>These are for Unix-domain sockets.
<code>file:///var/guix/daemon-socket/socket</code> is equivalent to
<samp>/var/guix/daemon-socket/socket</samp>.
</p>
</dd>
<dt><code>guix</code></dt>
<dd><span id="index-daemon_002c-remote-access-1"></span>
<span id="index-remote-access-to-the-daemon-1"></span>
<span id="index-daemon_002c-cluster-setup-1"></span>
<span id="index-clusters_002c-daemon-setup-1"></span>
<p>These URIs denote connections over TCP/IP, without encryption nor
authentication of the remote host.  The URI must specify the host name
and optionally a port number (by default port 44146 is used):
</p>
<div class="example">
<pre class="example">guix://master.guix.example.org:1234
</pre></div>

<p>This setup is suitable on local networks, such as clusters, where only
trusted nodes may connect to the build daemon at
<code>master.guix.example.org</code>.
</p>
<p>The <samp>--listen</samp> option of <code>guix-daemon</code> can be used to
instruct it to listen for TCP connections (see <a href="Invoking-guix_002ddaemon.html"><samp>--listen</samp></a>).
</p>
</dd>
<dt><code>ssh</code></dt>
<dd><span id="index-SSH-access-to-build-daemons"></span>
<p>These URIs allow you to connect to a remote daemon over SSH.  This
feature requires Guile-SSH (see <a href="Requirements.html">Requirements</a>) and a working
<code>guile</code> binary in <code>PATH</code> on the destination machine.  It
supports public key and GSSAPI authentication.  A typical URL might look
like this:
</p>
<div class="example">
<pre class="example">ssh://charlie@guix.example.org:22
</pre></div>

<p>As for <code>guix copy</code>, the usual OpenSSH client configuration files
are honored (see <a href="Invoking-guix-copy.html">Invoking guix copy</a>).
</p></dd>
</dl>

<p>Additional URI schemes may be supported in the future.
</p>
<blockquote>
<p><b>Note:</b> The ability to connect to remote build daemons is considered
experimental as of 1.4.0.  Please get in touch with us to
share any problems or suggestions you may have (see <a href="Contributing.html">Contributing</a>).
</p></blockquote>
</dd></dl>

<dl>
<dt id="index-open_002dconnection" class="symbol-definition"><span class="symbol-definition-category">Scheme Procedure: </span><span class="symbol-definition-prototype">open-connection [<var>uri</var>] [#:reserve-space? #t]</span></dt>
<dd><p>Connect to the daemon over the Unix-domain socket at <var>uri</var> (a string).  When
<var>reserve-space?</var> is true, instruct it to reserve a little bit of
extra space on the file system so that the garbage collector can still
operate should the disk become full.  Return a server object.
</p>
<p><var>file</var> defaults to <code>%default-socket-path</code>, which is the normal
location given the options that were passed to <code>configure</code>.
</p></dd></dl>

<dl>
<dt id="index-close_002dconnection" class="symbol-definition"><span class="symbol-definition-category">Scheme Procedure: </span><span class="symbol-definition-prototype">close-connection <var>server</var></span></dt>
<dd><p>Close the connection to <var>server</var>.
</p></dd></dl>

<dl>
<dt id="index-current_002dbuild_002doutput_002dport" class="symbol-definition"><span class="symbol-definition-category">Scheme Variable: </span><span class="symbol-definition-prototype">current-build-output-port </span></dt>
<dd><p>This variable is bound to a SRFI-39 parameter, which refers to the port
where build and error logs sent by the daemon should be written.
</p></dd></dl>

<p>Procedures that make RPCs all take a server object as their first
argument.
</p>
<dl>
<dt id="index-valid_002dpath_003f" class="symbol-definition"><span class="symbol-definition-category">Scheme Procedure: </span><span class="symbol-definition-prototype">valid-path? <var>server</var> <var>path</var></span></dt>
<dd><span id="index-invalid-store-items"></span>
<p>Return <code>#t</code> when <var>path</var> designates a valid store item and
<code>#f</code> otherwise (an invalid item may exist on disk but still be
invalid, for instance because it is the result of an aborted or failed
build).
</p>
<p>A <code>&amp;store-protocol-error</code> condition is raised if <var>path</var> is not
prefixed by the store directory (<samp>/gnu/store</samp>).
</p></dd></dl>

<dl>
<dt id="index-add_002dtext_002dto_002dstore" class="symbol-definition"><span class="symbol-definition-category">Scheme Procedure: </span><span class="symbol-definition-prototype">add-text-to-store <var>server</var> <var>name</var> <var>text</var> [<var>references</var>]</span></dt>
<dd><p>Add <var>text</var> under file <var>name</var> in the store, and return its store
path.  <var>references</var> is the list of store paths referred to by the
resulting store path.
</p></dd></dl>

<dl>
<dt id="index-build_002dderivations" class="symbol-definition"><span class="symbol-definition-category">Scheme Procedure: </span><span class="symbol-definition-prototype">build-derivations <var>store</var> <var>derivations</var>   [<var>mode</var>]</span></dt>
<dd><p>Build <var>derivations</var>, a list of <code>&lt;derivation&gt;</code> objects, <samp>.drv</samp>
file names, or derivation/output pairs, using the specified
<var>mode</var>&mdash;<code>(build-mode normal)</code> by default.
</p></dd></dl>

<p>Note that the <code>(guix monads)</code> module provides a monad as well as
monadic versions of the above procedures, with the goal of making it
more convenient to work with code that accesses the store (see <a href="The-Store-Monad.html">The Store Monad</a>).
</p>
<p><i>This section is currently incomplete.</i>
</p>
<hr />
<div class="header">
<p>
Next: <a href="Derivations.html" accesskey="n" rel="next">Derivations</a>, Previous: <a href="Search-Paths.html" accesskey="p" rel="prev">Search Paths</a>, Up: <a href="Programming-Interface.html" accesskey="u" rel="up">Programming Interface</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
