<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--   Copyright (C) 2012-2022 Ludovic Courtès

Copyright (C) 2013, 2014, 2016 Andreas Enge

Copyright (C) 2013 Nikita Karetnikov

Copyright (C) 2014, 2015, 2016 Alex Kost

Copyright (C) 2015, 2016 Mathieu Lirzin

Copyright (C) 2014 Pierre-Antoine Rault

Copyright (C) 2015 Taylan Ulrich Bayırlı/Kammer

Copyright (C) 2015, 2016, 2017, 2019, 2020, 2021 Leo Famulari

Copyright (C) 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022 Ricardo Wurmus

Copyright (C) 2016 Ben Woodcroft

Copyright (C) 2016, 2017, 2018, 2021 Chris Marusich

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021, 2022 Efraim Flashner

Copyright (C) 2016 John Darrington

Copyright (C) 2016, 2017 Nikita Gillmann

Copyright (C) 2016, 2017, 2018, 2019, 2020 Jan Nieuwenhuizen

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021 Julien Lepiller

Copyright (C) 2016 Alex ter Weele

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021 Christopher Baines

Copyright (C) 2017, 2018, 2019 Clément Lassieur

Copyright (C) 2017, 2018, 2020, 2021, 2022 Mathieu Othacehe

Copyright (C) 2017 Federico Beffa

Copyright (C) 2017, 2018 Carlo Zancanaro

Copyright (C) 2017 Thomas Danckaert

Copyright (C) 2017 humanitiesNerd

Copyright (C) 2017, 2021 Christine Lemmer-Webber

Copyright (C) 2017, 2018, 2019, 2020, 2021, 2022 Marius Bakke

Copyright (C) 2017, 2019, 2020, 2022 Hartmut Goebel

Copyright (C) 2017, 2019, 2020, 2021, 2022 Maxim Cournoyer

Copyright (C) 2017–2022 Tobias Geerinckx-Rice

Copyright (C) 2017 George Clemmer

Copyright (C) 2017 Andy Wingo

Copyright (C) 2017, 2018, 2019, 2020 Arun Isaac

Copyright (C) 2017 nee

Copyright (C) 2018 Rutger Helling

Copyright (C) 2018, 2021 Oleg Pykhalov

Copyright (C) 2018 Mike Gerwitz

Copyright (C) 2018 Pierre-Antoine Rouby

Copyright (C) 2018, 2019 Gábor Boskovits

Copyright (C) 2018, 2019, 2020, 2022 Florian Pelz

Copyright (C) 2018 Laura Lazzati

Copyright (C) 2018 Alex Vong

Copyright (C) 2019 Josh Holland

Copyright (C) 2019, 2020 Diego Nicola Barbato

Copyright (C) 2019 Ivan Petkov

Copyright (C) 2019 Jakob L. Kreuze

Copyright (C) 2019 Kyle Andrews

Copyright (C) 2019 Alex Griffin

Copyright (C) 2019, 2020, 2021, 2022 Guillaume Le Vaillant

Copyright (C) 2020 Liliana Marie Prikler

Copyright (C) 2019, 2020, 2021, 2022 Simon Tournier

Copyright (C) 2020 Wiktor Żelazny

Copyright (C) 2020 Damien Cassou

Copyright (C) 2020 Jakub Kądziołka

Copyright (C) 2020 Jack Hill

Copyright (C) 2020 Naga Malleswari

Copyright (C) 2020, 2021 Brice Waegeneire

Copyright (C) 2020 R Veera Kumar

Copyright (C) 2020, 2021 Pierre Langlois

Copyright (C) 2020 pinoaffe

Copyright (C) 2020 André Batista

Copyright (C) 2020, 2021 Alexandru-Sergiu Marton

Copyright (C) 2020 raingloom

Copyright (C) 2020 Daniel Brooks

Copyright (C) 2020 John Soo

Copyright (C) 2020 Jonathan Brielmaier

Copyright (C) 2020 Edgar Vincent

Copyright (C) 2021, 2022 Maxime Devos

Copyright (C) 2021 B. Wilson

Copyright (C) 2021 Xinglu Chen

Copyright (C) 2021 Raghav Gururajan

Copyright (C) 2021 Domagoj Stolfa

Copyright (C) 2021 Hui Lu

Copyright (C) 2021 pukkamustard

Copyright (C) 2021 Alice Brenon

Copyright (C) 2021, 2022 Josselin Poiret

Copyright (C) 2021 muradm

Copyright (C) 2021, 2022 Andrew Tropin

Copyright (C) 2021 Sarah Morgensen

Copyright (C) 2022 Remco van 't Veer

Copyright (C) 2022 Aleksandr Vityazev

Copyright (C) 2022 Philip McGrath

Copyright (C) 2022 Karl Hallsby

Copyright (C) 2022 Justin Veilleux

Copyright (C) 2022 Reily Siegel

Copyright (C) 2022 Simon Streit

Copyright (C) 2022 (

Copyright (C) 2022 John Kehayias


Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.  A
copy of the license is included in the section entitled "GNU Free
Documentation License".   -->
<!--   Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/   -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Complex Configurations (GNU Guix Reference Manual)</title>

<meta name="description" content="Complex Configurations (GNU Guix Reference Manual)" />
<meta name="keywords" content="Complex Configurations (GNU Guix Reference Manual)" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="Generator" content="makeinfo" />
<link href="index.html" rel="start" title="Top" />
<link href="Concept-Index.html" rel="index" title="Concept Index" />
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents" />
<link href="Defining-Services.html" rel="up" title="Defining Services" />
<link href="Home-Configuration.html" rel="next" title="Home Configuration" />
<link href="Shepherd-Services.html" rel="prev" title="Shepherd Services" />
<style type="text/css">
&amp;lt;!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
--&amp;gt;
</style>
<link rel="stylesheet" type="text/css" href="https://www.gnu.org/software/gnulib/manual.css" />

<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" type="text/css" href="../../../static/base/css/manual.css" /><link rel="stylesheet" type="text/css" href="../../../static/base/css/code.css" /></head>

<body lang="en"><header class="navbar"><h1><a class="branding" href="https://guix.gnu.org/manual/en/"></a></h1><nav class="navbar-menu"><input class="navbar-menu-hidden-input" type="radio" name="dropdown" id="all-dropdowns-hidden" /><ul><li class="navbar-menu-item dropdown dropdown-btn"><input class="navbar-menu-hidden-input" type="radio" name="dropdown" id="visible-dropdown" /><label for="visible-dropdown"><img alt="Language" src="../../../static/base/img/language-picker.svg" /></label><label for="all-dropdowns-hidden"><img alt="Language" src="../../../static/base/img/language-picker.svg" /></label><div class="navbar-submenu" id="navbar-submenu"><div class="navbar-submenu-triangle"> </div><ul><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/de/html_node">Deutsch</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/en/html_node">English</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/es/html_node">Español</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/fr/html_node">français</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/pt-br/html_node">Português</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/ru/html_node">русский</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/zh-cn/html_node">中文</a></li><li><a class="navbar-menu-item" href="https://translate.fedoraproject.org/projects/guix/documentation-manual/">⊕</a></li></ul></div></li></ul></nav><a class="navbar-menu-btn" href="https://guix.gnu.org/manual/"></a></header>
<span id="Complex-Configurations"></span><div class="header">
<p>
Previous: <a href="Shepherd-Services.html" accesskey="p" rel="prev">Shepherd Services</a>, Up: <a href="Defining-Services.html" accesskey="u" rel="up">Defining Services</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr />
<span id="Complex-Configurations-1"></span><h4 class="subsection">12.18.5 Complex Configurations</h4>
<span id="index-complex-configurations"></span>
<p>Some programs might have rather complex configuration files or formats,
and to make it easier to create Scheme bindings for these configuration
files, you can use the utilities defined in the <code>(gnu services
configuration)</code> module.
</p>
<p>The main utility is the <code>define-configuration</code> macro, which you
will use to define a Scheme record type (see <a href="https://www.gnu.org/software/guile/manual/html_node/Record-Overview.html#Record-Overview">Record Overview</a> in <cite>GNU Guile Reference Manual</cite>).  The Scheme record will be
serialized to a configuration file by using <em>serializers</em>, which are
procedures that take some kind of Scheme value and returns a
G-expression (see <a href="G_002dExpressions.html">G-Expressions</a>), which should, once serialized to
the disk, return a string.  More details are listed below.
</p>
<dl>
<dt id="index-define_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Scheme Syntax: </span><span class="symbol-definition-prototype">define-configuration <var>name</var> <var>clause1</var> <var>clause2</var> ...</span></dt>
<dd><p>Create a record type named <code><var>name</var></code> that contains the
fields found in the clauses.
</p>
<p>A clause can have one of the following forms:
</p>
<div class="example">
<pre class="example">(<var>field-name</var>
 (<var>type</var> <var>default-value</var>)
 <var>documentation</var>)
 
(<var>field-name</var>
 (<var>type</var> <var>default-value</var>)
 <var>documentation</var>
 <var>serializer</var>)

(<var>field-name</var>
 (<var>type</var>)
 <var>documentation</var>)

(<var>field-name</var>
 (<var>type</var>)
 <var>documentation</var>
 <var>serializer</var>)
</pre></div>

<p><var>field-name</var> is an identifier that denotes the name of the field in
the generated record.
</p>
<p><var>type</var> is the type of the value corresponding to <var>field-name</var>;
since Guile is untyped, a predicate
procedure&mdash;<code><var>type</var>?</code>&mdash;will be called on the value
corresponding to the field to ensure that the value is of the correct
type.  This means that if say, <var>type</var> is <code>package</code>, then a
procedure named <code>package?</code> will be applied on the value to make
sure that it is indeed a <code>&lt;package&gt;</code> object.
</p>
<p><var>default-value</var> is the default value corresponding to the field; if
none is specified, the user is forced to provide a value when creating
an object of the record type.
</p>
<p><var>documentation</var> is a string formatted with Texinfo syntax which
should provide a description of what setting this field does.
</p>
<p><var>serializer</var> is the name of a procedure which takes two arguments,
the first is the name of the field, and the second is the value
corresponding to the field.  The procedure should return a string or
G-expression (see <a href="G_002dExpressions.html">G-Expressions</a>) that represents the content that
will be serialized to the configuration file.  If none is specified, a
procedure of the name <code>serialize-<var>type</var></code> will be used.
</p>
<p>A simple serializer procedure could look like this:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">serialize-boolean</span> <span class="syntax-symbol">field-name</span> <span class="syntax-symbol">value</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-special">let</span> <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-symbol">value</span> <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-special">if</span> <span class="syntax-symbol">value</span> <span class="syntax-string">"true"</span> <span class="syntax-string">"false"</span></span>)</span></span>)</span></span>)</span>
    <span class="syntax-symbol">#~</span><span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Reversing-and-Appending-Strings.html#index-string_002dappend">string-append</a> <span class="syntax-symbol">#$field-name</span> <span class="syntax-symbol">#$value</span></span>)</span></span>)</span></span>)</span>
</pre></div>

<p>In some cases multiple different configuration records might be defined
in the same file, but their serializers for the same type might have to
be different, because they have different configuration formats.  For
example, the <code>serialize-boolean</code> procedure for the Getmail service
would have to be different from the one for the Transmission service.  To
make it easier to deal with this situation, one can specify a serializer
prefix by using the <code>prefix</code> literal in the
<code>define-configuration</code> form.  This means that one doesn&rsquo;t have to
manually specify a custom <var>serializer</var> for every field.
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">foo-serialize-string</span> <span class="syntax-symbol">field-name</span> <span class="syntax-symbol">value</span></span>)</span>
  <span class="syntax-symbol">…</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">bar-serialize-string</span> <span class="syntax-symbol">field-name</span> <span class="syntax-symbol">value</span></span>)</span>
  <span class="syntax-symbol">…</span></span>)</span>
  
<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define-configuration</span> <span class="syntax-symbol">foo-configuration</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">label</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/String-Constructors.html#index-string">string</a></span>)</span>
   <span class="syntax-string">"The name of label."</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">prefix</span> <span class="syntax-symbol">foo-</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define-configuration</span> <span class="syntax-symbol">bar-configuration</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">ip-address</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/String-Constructors.html#index-string">string</a></span>)</span>
   <span class="syntax-string">"The IPv4 address for this device."</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">prefix</span> <span class="syntax-symbol">bar-</span></span>)</span></span>)</span>
</pre></div>

<p>However, in some cases you might not want to serialize any of the values
of the record, to do this, you can use the <code>no-serialization</code>
literal.  There is also the <code>define-configuration/no-serialization</code>
macro which is a shorthand of this.
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-comment">;; Nothing will be serialized to disk.
</span><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define-configuration</span> <span class="syntax-symbol">foo-configuration</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">field</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/String-Constructors.html#index-string">string</a> <span class="syntax-string">"test"</span></span>)</span>
   <span class="syntax-string">"Some documentation."</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">no-serialization</span></span>)</span></span>)</span>

<span class="syntax-comment">;; The same thing as above.
</span><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define-configuration/no-serialization</span> <span class="syntax-symbol">bar-configuration</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">field</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/String-Constructors.html#index-string">string</a> <span class="syntax-string">"test"</span></span>)</span>
   <span class="syntax-string">"Some documentation."</span></span>)</span></span>)</span>
</pre></div>
</dd></dl>

<dl>
<dt id="index-define_002dmaybe" class="symbol-definition"><span class="symbol-definition-category">Scheme Syntax: </span><span class="symbol-definition-prototype">define-maybe <var>type</var></span></dt>
<dd><p>Sometimes a field should not be serialized if the user doesn’t specify a
value.  To achieve this, you can use the <code>define-maybe</code> macro to
define a &ldquo;maybe type&rdquo;; if the value of a maybe type is left unset, or
is set to the <code>%unset-value</code> value, then it will not be serialized.
</p>
<p>When defining a &ldquo;maybe type&rdquo;, the corresponding serializer for the
regular type will be used by default.  For example, a field of type
<code>maybe-string</code> will be serialized using the <code>serialize-string</code>
procedure by default, you can of course change this by specifying a
custom serializer procedure.  Likewise, the type of the value would have
to be a string, or left unspecified.
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define-maybe</span> <a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/String-Constructors.html#index-string">string</a></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">serialize-string</span> <span class="syntax-symbol">field-name</span> <span class="syntax-symbol">value</span></span>)</span>
  <span class="syntax-symbol">…</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define-configuration</span> <span class="syntax-symbol">baz-configuration</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">name</span>
   <span class="syntax-comment">;; If set to a string, the `serialize-string' procedure will be used
</span>   <span class="syntax-comment">;; to serialize the string.  Otherwise this field is not serialized.
</span>   <span class="syntax-symbol">maybe-string</span>
   <span class="syntax-string">"The name of this module."</span></span>)</span></span>)</span>
</pre></div>

<p>Like with <code>define-configuration</code>, one can set a prefix for the
serializer name by using the <code>prefix</code> literal.
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define-maybe</span> <span class="syntax-symbol">integer</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">prefix</span> <span class="syntax-symbol">baz-</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">baz-serialize-integer</span> <span class="syntax-symbol">field-name</span> <span class="syntax-symbol">value</span></span>)</span>
  <span class="syntax-symbol">…</span></span>)</span>
</pre></div>

<p>There is also the <code>no-serialization</code> literal, which when set means
that no serializer will be defined for the &ldquo;maybe type&rdquo;, regardless of
whether its value is set or not.
<code>define-maybe/no-serialization</code> is a shorthand for specifying the
<code>no-serialization</code> literal.
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define-maybe/no-serialization</span> <a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Symbol-Primitives.html#index-symbol">symbol</a></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define-configuration/no-serialization</span> <span class="syntax-symbol">test-configuration</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">mode</span>
   <span class="syntax-symbol">maybe-symbol</span>
   <span class="syntax-string">"Docstring."</span></span>)</span></span>)</span>
</pre></div>
</dd></dl>

<dl>
<dt id="index-Procedure_0029" class="symbol-definition"><span class="symbol-definition-category">(Scheme: </span><span class="symbol-definition-prototype">Procedure) maybe-value-set? <var>value</var></span></dt>
<dd><p>Predicate to check whether a user explicitly specified the value of a
maybe field.
</p></dd></dl>

<dl>
<dt id="index-serialize_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Scheme Procedure: </span><span class="symbol-definition-prototype">serialize-configuration <var>configuration</var> <var>fields</var></span></dt>
<dd><p>Return a G-expression that contains the values corresponding to the
<var>fields</var> of <var>configuration</var>, a record that has been generated by
<code>define-configuration</code>.  The G-expression can then be serialized to
disk by using something like <code>mixed-text-file</code>.
</p></dd></dl>

<dl>
<dt id="index-empty_002dserializer" class="symbol-definition"><span class="symbol-definition-category">Scheme Procedure: </span><span class="symbol-definition-prototype">empty-serializer <var>field-name</var> <var>value</var></span></dt>
<dd><p>A serializer that just returns an empty string.  The
<code>serialize-package</code> procedure is an alias for this.
</p></dd></dl>

<p>Once you have defined a configuration record, you will most likely also
want to document it so that other people know to use it.  To help with
that, there are two procedures, both of which are documented below.
</p>
<dl>
<dt id="index-generate_002ddocumentation" class="symbol-definition"><span class="symbol-definition-category">Scheme Procedure: </span><span class="symbol-definition-prototype">generate-documentation <var>documentation</var> <var>documentation-name</var></span></dt>
<dd><p>Generate a Texinfo fragment from the docstrings in <var>documentation</var>,
a list of <code>(<var>label</var> <var>fields</var> <var>sub-documentation</var> ...)</code>.
<var>label</var> should be a symbol and should be the name of the
configuration record.  <var>fields</var> should be a list of all the fields
available for the configuration record.
</p>
<p><var>sub-documentation</var> is a <code>(<var>field-name</var>
<var>configuration-name</var>)</code> tuple.  <var>field-name</var> is the name of the
field which takes another configuration record as its value, and
<var>configuration-name</var> is the name of that configuration record.
</p>
<p><var>sub-documentation</var> is only needed if there are nested configuration
records.  For example, the <code>getmail-configuration</code> record
(see <a href="Mail-Services.html">Mail Services</a>) accepts a <code>getmail-configuration-file</code>
record in one of its <code>rcfile</code> field, therefore documentation for
<code>getmail-configuration-file</code> is nested in
<code>getmail-configuration</code>.
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Complex-Configurations.html#index-generate_002ddocumentation">generate-documentation</a>
  <span class="syntax-symbol">`</span><span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">getmail-configuration</span> <span class="syntax-symbol">,getmail-configuration-fields</span>
     <span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-symbol">rcfile</span> <span class="syntax-symbol">getmail-configuration-file</span></span>)</span></span>)</span>
    <span class="syntax-symbol">…</span></span>)</span>
  <span class="syntax-symbol">'getmail-configuration</span></span>)</span>
</pre></div>

<p><var>documentation-name</var> should be a symbol and should be the name of
the configuration record.
</p>
</dd></dl>

<dl>
<dt id="index-configuration_002d_003edocumentation" class="symbol-definition"><span class="symbol-definition-category">Scheme Procedure: </span><span class="symbol-definition-prototype">configuration-&gt;documentation </span></dt>
<dd><p><var>configuration-symbol</var>
Take <var>configuration-symbol</var>, the symbol corresponding to the name
used when defining a configuration record with
<code>define-configuration</code>, and print the Texinfo documentation of its
fields.  This is useful if there aren’t any nested configuration records
since it only prints the documentation for the top-level fields.
</p></dd></dl>

<p>As of right now, there is no automated way to generate documentation for
configuration records and put them in the manual.  Instead, every
time you make a change to the docstrings of a configuration record, you
have to manually call <code>generate-documentation</code> or
<code>configuration-&gt;documentation</code>, and paste the output into the
<samp>doc/guix.texi</samp> file.
</p>
<p>Below is an example of a record type created using
<code>define-configuration</code> and friends.
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Using-Guile-Modules.html#index-use_002dmodules">use-modules</a> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">gnu</span> <span class="syntax-symbol">services</span></span>)</span>
             <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">guix</span> <span class="syntax-symbol">gexp</span></span>)</span>
             <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">gnu</span> <span class="syntax-symbol">services</span> <span class="syntax-symbol">configuration</span></span>)</span>
             <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">srfi</span> <span class="syntax-symbol">srfi-26</span></span>)</span>
             <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">srfi</span> <span class="syntax-symbol">srfi-1</span></span>)</span></span>)</span>

<span class="syntax-comment">;; Turn field names, which are Scheme symbols into strings
</span><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">uglify-field-name</span> <span class="syntax-symbol">field-name</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-special">let</span> <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-paren3">(<span class="syntax-symbol"><span class="syntax-symbol">str</span> <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Symbol-Primitives.html#index-symbol_002d_003estring">symbol-&gt;string</a> <span class="syntax-symbol">field-name</span></span>)</span></span>)</span></span>)</span>
    <span class="syntax-comment">;; field? -&gt; is-field
</span>    <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-special">if</span> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/String-Searching.html#index-string_002dsuffix_003f">string-suffix?</a> <span class="syntax-string">"?"</span> <span class="syntax-symbol">str</span></span>)</span>
        <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Reversing-and-Appending-Strings.html#index-string_002dappend">string-append</a> <span class="syntax-string">"is-"</span> <span class="syntax-paren4">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/String-Selection.html#index-string_002ddrop_002dright">string-drop-right</a> <span class="syntax-symbol">str</span> <span class="syntax-symbol">1</span></span>)</span></span>)</span>
        <span class="syntax-symbol">str</span></span>)</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">serialize-string</span> <span class="syntax-symbol">field-name</span> <span class="syntax-symbol">value</span></span>)</span>
  <span class="syntax-symbol">#~</span><span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Reversing-and-Appending-Strings.html#index-string_002dappend">string-append</a> <span class="syntax-symbol">#$</span><span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">uglify-field-name</span> <span class="syntax-symbol">field-name</span></span>)</span> <span class="syntax-string">" = "</span> <span class="syntax-symbol">#$value</span> <span class="syntax-string">"\n"</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">serialize-integer</span> <span class="syntax-symbol">field-name</span> <span class="syntax-symbol">value</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">serialize-string</span> <span class="syntax-symbol">field-name</span> <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Conversion.html#index-number_002d_003estring">number-&gt;string</a> <span class="syntax-symbol">value</span></span>)</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">serialize-boolean</span> <span class="syntax-symbol">field-name</span> <span class="syntax-symbol">value</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">serialize-string</span> <span class="syntax-symbol">field-name</span> <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-special">if</span> <span class="syntax-symbol">value</span> <span class="syntax-string">"true"</span> <span class="syntax-string">"false"</span></span>)</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">serialize-contact-name</span> <span class="syntax-symbol">field-name</span> <span class="syntax-symbol">value</span></span>)</span>
  <span class="syntax-symbol">#~</span><span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Reversing-and-Appending-Strings.html#index-string_002dappend">string-append</a> <span class="syntax-string">"\n["</span> <span class="syntax-symbol">#$value</span> <span class="syntax-string">"]\n"</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">list-of-contact-configurations?</span> <span class="syntax-symbol">lst</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/SRFI_002d1-Searching.html#index-every">every</a> <span class="syntax-symbol">contact-configuration?</span> <span class="syntax-symbol">lst</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">serialize-list-of-contact-configurations</span> <span class="syntax-symbol">field-name</span> <span class="syntax-symbol">value</span></span>)</span>
  <span class="syntax-symbol">#~</span><span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Reversing-and-Appending-Strings.html#index-string_002dappend">string-append</a> <span class="syntax-symbol">#$@</span><span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-special">map</span> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/SRFI_002d26.html#index-cut">cut</a> <a class="syntax-symbol" href="Complex-Configurations.html#index-serialize_002dconfiguration">serialize-configuration</a> <span class="syntax-symbol">&lt;&gt;</span>
                                <span class="syntax-symbol">contact-configuration-fields</span></span>)</span>
                           <span class="syntax-symbol">value</span></span>)</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">serialize-contacts-list-configuration</span> <span class="syntax-symbol">configuration</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><a class="syntax-symbol" href="G_002dExpressions.html#index-mixed_002dtext_002dfile">mixed-text-file</a>
   <span class="syntax-string">"contactrc"</span>
   <span class="syntax-symbol">#~</span><span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/Reversing-and-Appending-Strings.html#index-string_002dappend">string-append</a> <span class="syntax-string">"[Owner]\n"</span>
                    <span class="syntax-symbol">#$</span><span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="Complex-Configurations.html#index-serialize_002dconfiguration">serialize-configuration</a>
                       <span class="syntax-symbol">configuration</span> <span class="syntax-symbol">contacts-list-configuration-fields</span></span>)</span></span>)</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define-maybe</span> <span class="syntax-symbol">integer</span></span>)</span>
<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define-maybe</span> <a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/String-Constructors.html#index-string">string</a></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define-configuration</span> <span class="syntax-symbol">contact-configuration</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">name</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/String-Constructors.html#index-string">string</a></span>)</span>
   <span class="syntax-string">"The name of the contact."</span>
   <span class="syntax-symbol">serialize-contact-name</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">phone-number</span>
   <span class="syntax-symbol">maybe-integer</span>
   <span class="syntax-string">"The person's phone number."</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">email</span>
   <span class="syntax-symbol">maybe-string</span>
   <span class="syntax-string">"The person's email address."</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">married?</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">boolean</span></span>)</span>
   <span class="syntax-string">"Whether the person is married."</span></span>)</span></span>)</span>

<span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define-configuration</span> <span class="syntax-symbol">contacts-list-configuration</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">name</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/String-Constructors.html#index-string">string</a></span>)</span>
   <span class="syntax-string">"The name of the owner of this contact list."</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">email</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/String-Constructors.html#index-string">string</a></span>)</span>
   <span class="syntax-string">"The owner's email address."</span></span>)</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">contacts</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">list-of-contact-configurations</span> <span class="syntax-symbol">'</span><span class="syntax-paren3">(<span class="syntax-symbol"></span>)</span></span>)</span>
   <span class="syntax-string">"A list of @code{contact-configuation} records which contain
information about all your contacts."</span></span>)</span></span>)</span>
</pre></div>

<p>A contacts list configuration could then be created like this:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><span class="syntax-special">define</span> <span class="syntax-symbol">my-contacts</span>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">contacts-list-configuration</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">name</span> <span class="syntax-string">"Alice"</span></span>)</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">email</span> <span class="syntax-string">"alice@example.org"</span></span>)</span>
   <span class="syntax-paren2">(<span class="syntax-symbol"><span class="syntax-symbol">contacts</span>
    <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="https://www.gnu.org/software/guile/manual/html_node/List-Constructors.html#index-list-1">list</a> <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">contact-configuration</span>
           <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">name</span> <span class="syntax-string">"Bob"</span></span>)</span>
           <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">phone-number</span> <span class="syntax-symbol">1234</span></span>)</span>
           <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">email</span> <span class="syntax-string">"bob@gnu.org"</span></span>)</span>
           <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">married?</span> <span class="syntax-symbol">#f</span></span>)</span></span>)</span>
          <span class="syntax-paren4">(<span class="syntax-symbol"><span class="syntax-symbol">contact-configuration</span>
           <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">name</span> <span class="syntax-string">"Charlie"</span></span>)</span>
           <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">phone-number</span> <span class="syntax-symbol">0000</span></span>)</span>
           <span class="syntax-paren5">(<span class="syntax-symbol"><span class="syntax-symbol">married?</span> <span class="syntax-symbol">#t</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
</pre></div>

<p>After serializing the configuration to disk, the resulting file would
look like this:
</p>
<div class="example">
<pre class="example">[owner]
name = Alice
email = alice@example.org

[Bob]
phone-number = 1234
email = bob@gnu.org
is-married = false

[Charlie]
phone-number = 0
is-married = true
</pre></div>


<hr />
<div class="header">
<p>
Previous: <a href="Shepherd-Services.html" accesskey="p" rel="prev">Shepherd Services</a>, Up: <a href="Defining-Services.html" accesskey="u" rel="up">Defining Services</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
