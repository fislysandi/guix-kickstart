<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--   Copyright (C) 2012-2022 Ludovic Courtès

Copyright (C) 2013, 2014, 2016 Andreas Enge

Copyright (C) 2013 Nikita Karetnikov

Copyright (C) 2014, 2015, 2016 Alex Kost

Copyright (C) 2015, 2016 Mathieu Lirzin

Copyright (C) 2014 Pierre-Antoine Rault

Copyright (C) 2015 Taylan Ulrich Bayırlı/Kammer

Copyright (C) 2015, 2016, 2017, 2019, 2020, 2021 Leo Famulari

Copyright (C) 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022 Ricardo Wurmus

Copyright (C) 2016 Ben Woodcroft

Copyright (C) 2016, 2017, 2018, 2021 Chris Marusich

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021, 2022 Efraim Flashner

Copyright (C) 2016 John Darrington

Copyright (C) 2016, 2017 Nikita Gillmann

Copyright (C) 2016, 2017, 2018, 2019, 2020 Jan Nieuwenhuizen

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021 Julien Lepiller

Copyright (C) 2016 Alex ter Weele

Copyright (C) 2016, 2017, 2018, 2019, 2020, 2021 Christopher Baines

Copyright (C) 2017, 2018, 2019 Clément Lassieur

Copyright (C) 2017, 2018, 2020, 2021, 2022 Mathieu Othacehe

Copyright (C) 2017 Federico Beffa

Copyright (C) 2017, 2018 Carlo Zancanaro

Copyright (C) 2017 Thomas Danckaert

Copyright (C) 2017 humanitiesNerd

Copyright (C) 2017, 2021 Christine Lemmer-Webber

Copyright (C) 2017, 2018, 2019, 2020, 2021, 2022 Marius Bakke

Copyright (C) 2017, 2019, 2020, 2022 Hartmut Goebel

Copyright (C) 2017, 2019, 2020, 2021, 2022 Maxim Cournoyer

Copyright (C) 2017–2022 Tobias Geerinckx-Rice

Copyright (C) 2017 George Clemmer

Copyright (C) 2017 Andy Wingo

Copyright (C) 2017, 2018, 2019, 2020 Arun Isaac

Copyright (C) 2017 nee

Copyright (C) 2018 Rutger Helling

Copyright (C) 2018, 2021 Oleg Pykhalov

Copyright (C) 2018 Mike Gerwitz

Copyright (C) 2018 Pierre-Antoine Rouby

Copyright (C) 2018, 2019 Gábor Boskovits

Copyright (C) 2018, 2019, 2020, 2022 Florian Pelz

Copyright (C) 2018 Laura Lazzati

Copyright (C) 2018 Alex Vong

Copyright (C) 2019 Josh Holland

Copyright (C) 2019, 2020 Diego Nicola Barbato

Copyright (C) 2019 Ivan Petkov

Copyright (C) 2019 Jakob L. Kreuze

Copyright (C) 2019 Kyle Andrews

Copyright (C) 2019 Alex Griffin

Copyright (C) 2019, 2020, 2021, 2022 Guillaume Le Vaillant

Copyright (C) 2020 Liliana Marie Prikler

Copyright (C) 2019, 2020, 2021, 2022 Simon Tournier

Copyright (C) 2020 Wiktor Żelazny

Copyright (C) 2020 Damien Cassou

Copyright (C) 2020 Jakub Kądziołka

Copyright (C) 2020 Jack Hill

Copyright (C) 2020 Naga Malleswari

Copyright (C) 2020, 2021 Brice Waegeneire

Copyright (C) 2020 R Veera Kumar

Copyright (C) 2020, 2021 Pierre Langlois

Copyright (C) 2020 pinoaffe

Copyright (C) 2020 André Batista

Copyright (C) 2020, 2021 Alexandru-Sergiu Marton

Copyright (C) 2020 raingloom

Copyright (C) 2020 Daniel Brooks

Copyright (C) 2020 John Soo

Copyright (C) 2020 Jonathan Brielmaier

Copyright (C) 2020 Edgar Vincent

Copyright (C) 2021, 2022 Maxime Devos

Copyright (C) 2021 B. Wilson

Copyright (C) 2021 Xinglu Chen

Copyright (C) 2021 Raghav Gururajan

Copyright (C) 2021 Domagoj Stolfa

Copyright (C) 2021 Hui Lu

Copyright (C) 2021 pukkamustard

Copyright (C) 2021 Alice Brenon

Copyright (C) 2021, 2022 Josselin Poiret

Copyright (C) 2021 muradm

Copyright (C) 2021, 2022 Andrew Tropin

Copyright (C) 2021 Sarah Morgensen

Copyright (C) 2022 Remco van 't Veer

Copyright (C) 2022 Aleksandr Vityazev

Copyright (C) 2022 Philip McGrath

Copyright (C) 2022 Karl Hallsby

Copyright (C) 2022 Justin Veilleux

Copyright (C) 2022 Reily Siegel

Copyright (C) 2022 Simon Streit

Copyright (C) 2022 (

Copyright (C) 2022 John Kehayias


Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.  A
copy of the license is included in the section entitled "GNU Free
Documentation License".   -->
<!--   Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/   -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Unattended Upgrades (GNU Guix Reference Manual)</title>

<meta name="description" content="Unattended Upgrades (GNU Guix Reference Manual)" />
<meta name="keywords" content="Unattended Upgrades (GNU Guix Reference Manual)" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="Generator" content="makeinfo" />
<link href="index.html" rel="start" title="Top" />
<link href="Concept-Index.html" rel="index" title="Concept Index" />
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents" />
<link href="Services.html" rel="up" title="Services" />
<link href="X-Window.html" rel="next" title="X Window" />
<link href="Networking-Services.html" rel="prev" title="Networking Services" />
<style type="text/css">
&amp;lt;!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
--&amp;gt;
</style>
<link rel="stylesheet" type="text/css" href="https://www.gnu.org/software/gnulib/manual.css" />

<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" type="text/css" href="../../../static/base/css/manual.css" /><link rel="stylesheet" type="text/css" href="../../../static/base/css/code.css" /></head>

<body lang="en"><header class="navbar"><h1><a class="branding" href="https://guix.gnu.org/manual/en/"></a></h1><nav class="navbar-menu"><input class="navbar-menu-hidden-input" type="radio" name="dropdown" id="all-dropdowns-hidden" /><ul><li class="navbar-menu-item dropdown dropdown-btn"><input class="navbar-menu-hidden-input" type="radio" name="dropdown" id="visible-dropdown" /><label for="visible-dropdown"><img alt="Language" src="../../../static/base/img/language-picker.svg" /></label><label for="all-dropdowns-hidden"><img alt="Language" src="../../../static/base/img/language-picker.svg" /></label><div class="navbar-submenu" id="navbar-submenu"><div class="navbar-submenu-triangle"> </div><ul><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/de/html_node">Deutsch</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/en/html_node">English</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/es/html_node">Español</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/fr/html_node">français</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/pt-br/html_node">Português</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/ru/html_node">русский</a></li><li><a class="navbar-menu-item" href="https://guix.gnu.org/manual/zh-cn/html_node">中文</a></li><li><a class="navbar-menu-item" href="https://translate.fedoraproject.org/projects/guix/documentation-manual/">⊕</a></li></ul></div></li></ul></nav><a class="navbar-menu-btn" href="https://guix.gnu.org/manual/"></a></header>
<span id="Unattended-Upgrades"></span><div class="header">
<p>
Next: <a href="X-Window.html" accesskey="n" rel="next">X Window</a>, Previous: <a href="Networking-Services.html" accesskey="p" rel="prev">Networking Services</a>, Up: <a href="Services.html" accesskey="u" rel="up">Services</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr />
<span id="Unattended-Upgrades-1"></span><h4 class="subsection">12.9.6 Unattended Upgrades</h4>

<span id="index-unattended-upgrades"></span>
<span id="index-upgrades_002c-unattended"></span>
<p>Guix provides a service to perform <em>unattended upgrades</em>:
periodically, the system automatically reconfigures itself from the
latest Guix.  Guix System has several properties that make unattended
upgrades safe:
</p>
<ul>
<li> upgrades are transactional (either the upgrade succeeds or it fails, but
you cannot end up with an &ldquo;in-between&rdquo; system state);
</li><li> the upgrade log is kept&mdash;you can view it with <code>guix system
list-generations</code>&mdash;and you can roll back to any previous generation,
should the upgraded system fail to behave as intended;
</li><li> channel code is authenticated so you know you can only run genuine code
(see <a href="Channels.html">Channels</a>);
</li><li> <code>guix system reconfigure</code> prevents downgrades, which makes it
immune to <em>downgrade attacks</em>.
</li></ul>

<p>To set up unattended upgrades, add an instance of
<code>unattended-upgrade-service-type</code> like the one below to the list of
your operating system services:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Service-Reference.html#index-service">service</a> <a class="syntax-symbol" href="Unattended-Upgrades.html#index-unattended_002dupgrade_002dservice_002dtype">unattended-upgrade-service-type</a></span>)</span>
</pre></div>

<p>The defaults above set up weekly upgrades: every Sunday at midnight.
You do not need to provide the operating system configuration file: it
uses <samp>/run/current-system/configuration.scm</samp>, which ensures it
always uses your latest configuration&mdash;see <a href="Service-Reference.html#provenance_002dservice_002dtype">provenance-service-type</a>,
for more information about this file.
</p>
<p>There are several things that can be configured, in particular the
periodicity and services (daemons) to be restarted upon completion.
When the upgrade is successful, the service takes care of deleting
system generations older that some threshold, as per <code>guix
system delete-generations</code>.  See the reference below for details.
</p>
<p>To ensure that upgrades are actually happening, you can run
<code>guix system describe</code>.  To investigate upgrade failures, visit
the unattended upgrade log file (see below).
</p>
<dl>
<dt id="index-unattended_002dupgrade_002dservice_002dtype" class="symbol-definition"><span class="symbol-definition-category">Scheme Variable: </span><span class="symbol-definition-prototype">unattended-upgrade-service-type </span></dt>
<dd><p>This is the service type for unattended upgrades.  It sets up an mcron
job (see <a href="Scheduled-Job-Execution.html">Scheduled Job Execution</a>) that runs <code>guix system
reconfigure</code> from the latest version of the specified channels.
</p>
<p>Its value must be a <code>unattended-upgrade-configuration</code> record (see
below).
</p></dd></dl>

<dl>
<dt id="index-unattended_002dupgrade_002dconfiguration" class="symbol-definition"><span class="symbol-definition-category">Data Type: </span><span class="symbol-definition-prototype">unattended-upgrade-configuration </span></dt>
<dd><p>This data type represents the configuration of the unattended upgrade
service.  The following fields are available:
</p>
<dl compact="compact">
<dt><code>schedule</code> (default: <code>"30 01 * * 0"</code>)</dt>
<dd><p>This is the schedule of upgrades, expressed as a gexp containing an
mcron job schedule (see <a href="https://www.gnu.org/software/mcron/manual/html_node/Guile-Syntax.html#Guile-Syntax">mcron job specifications</a> in <cite>GNU&nbsp;mcron</cite>).
</p>
</dd>
<dt><code>channels</code> (default: <code>#~%default-channels</code>)</dt>
<dd><p>This gexp specifies the channels to use for the upgrade
(see <a href="Channels.html">Channels</a>).  By default, the tip of the official <code>guix</code>
channel is used.
</p>
</dd>
<dt><code>operating-system-file</code> (default: <code>"/run/current-system/configuration.scm"</code>)</dt>
<dd><p>This field specifies the operating system configuration file to use.
The default is to reuse the config file of the current configuration.
</p>
<p>There are cases, though, where referring to
<samp>/run/current-system/configuration.scm</samp> is not enough, for instance
because that file refers to extra files (SSH public keys, extra
configuration files, etc.) <i>via</i> <code>local-file</code> and similar
constructs.  For those cases, we recommend something along these lines:
</p>
<div class="lisp">
<pre class="lisp"><span class="syntax-paren0">(<span class="syntax-symbol"><a class="syntax-symbol" href="Unattended-Upgrades.html#index-unattended_002dupgrade_002dconfiguration">unattended-upgrade-configuration</a>
  <span class="syntax-paren1">(<span class="syntax-symbol"><span class="syntax-symbol">operating-system-file</span>
    <span class="syntax-paren2">(<span class="syntax-symbol"><a class="syntax-symbol" href="G_002dExpressions.html#index-file_002dappend">file-append</a> <span class="syntax-paren3">(<span class="syntax-symbol"><a class="syntax-symbol" href="G_002dExpressions.html#index-local_002dfile">local-file</a> <span class="syntax-string">"."</span> <span class="syntax-string">"config-dir"</span> <span class="syntax-keyword">#:recursive?</span> <span class="syntax-symbol">#t</span></span>)</span>
                 <span class="syntax-string">"/config.scm"</span></span>)</span></span>)</span></span>)</span>
</pre></div>

<p>The effect here is to import all of the current directory into the
store, and to refer to <samp>config.scm</samp> within that directory.
Therefore, uses of <code>local-file</code> within <samp>config.scm</samp> will work
as expected.  See <a href="G_002dExpressions.html">G-Expressions</a>, for information about
<code>local-file</code> and <code>file-append</code>.
</p>
</dd>
<dt><code>services-to-restart</code> (default: <code>'(mcron)</code>)</dt>
<dd><p>This field specifies the Shepherd services to restart when the upgrade
completes.
</p>
<p>Those services are restarted right away upon completion, as with
<code>herd restart</code>, which ensures that the latest version is
running&mdash;remember that by default <code>guix system reconfigure</code>
only restarts services that are not currently running, which is
conservative: it minimizes disruption but leaves outdated services
running.
</p>
<p>Use <code>herd status</code> to find out candidates for restarting.
See <a href="Services.html">Services</a>, for general information about services.  Common
services to restart would include <code>ntpd</code> and <code>ssh-daemon</code>.
</p>
<p>By default, the <code>mcron</code> service is restarted.  This ensures that
the latest version of the unattended upgrade job will be used next time.
</p>
</dd>
<dt><code>system-expiration</code> (default: <code>(* 3 30 24 3600)</code>)</dt>
<dd><p>This is the expiration time in seconds for system generations.  System
generations older that this amount of time are deleted with
<code>guix system delete-generations</code> when an upgrade completes.
</p>
<blockquote>
<p><b>Note:</b> The unattended upgrade service does not run the garbage collector.  You
will probably want to set up your own mcron job to run <code>guix gc</code>
periodically.
</p></blockquote>

</dd>
<dt><code>maximum-duration</code> (default: <code>3600</code>)</dt>
<dd><p>Maximum duration in seconds for the upgrade; past that time, the upgrade
aborts.
</p>
<p>This is primarily useful to ensure the upgrade does not end up
rebuilding or re-downloading &ldquo;the world&rdquo;.
</p>
</dd>
<dt><code>log-file</code> (default: <code>"/var/log/unattended-upgrade.log"</code>)</dt>
<dd><p>File where unattended upgrades are logged.
</p></dd>
</dl>
</dd></dl>

<hr />
<div class="header">
<p>
Next: <a href="X-Window.html" accesskey="n" rel="next">X Window</a>, Previous: <a href="Networking-Services.html" accesskey="p" rel="prev">Networking Services</a>, Up: <a href="Services.html" accesskey="u" rel="up">Services</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
